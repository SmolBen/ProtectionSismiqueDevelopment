<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFSS Project Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="review-tab.css">
    <link rel="stylesheet" href="project-details.css">
    <link rel="stylesheet" href="cfss-project-details.css">
    <link rel="stylesheet" href="email.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <style>
    /* Page-level tabs (for interior-system projects with rooms) */
    .page-tabs {
        display: flex;
        gap: 0;
        margin-bottom: 0;
        border-bottom: 3px solid #e0e0e0;
        background: #f8f9fa;
        border-radius: 8px 8px 0 0;
        overflow: hidden;
    }
    .page-tab-btn {
        padding: 14px 28px;
        border: none;
        background: #f0f0f0;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        color: #666;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: -3px;
    }
    .page-tab-btn:hover {
        background: #e8e8e8;
        color: #333;
    }
    .page-tab-btn.active {
        background: white;
        color: #17a2b8;
        border-bottom-color: #17a2b8;
    }
    .room-images-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        gap: 8px;
        margin-top: 8px;
    }
    .room-image-thumb {
        width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #ddd;
        cursor: pointer;
    }
    .room-edit-images-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
        margin-top: 8px;
    }
    .room-edit-image-wrapper {
        position: relative;
        width: 100%;
        aspect-ratio: 1;
    }
    .room-edit-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #ddd;
    }
    .room-edit-image-wrapper .image-remove {
        position: absolute;
        top: 2px;
        right: 2px;
    }
    </style>

        <!-- SortableJS for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script> 

</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="title-area">
                <a href="https://www.protectionsismique2000.com/" class="title">Protection Sismique - CFSS</a>
                <a href="cfss-dashboard.html" class="dashboard-btn">
                    <i class="fas fa-th-large"></i>
                    <span data-i18n="common.dashboard">Dashboard</span>
                </a>
            </div>
            <div class="user-info" id="userInfo">
                <!-- User info will be populated by JavaScript -->
            </div>
        </div>
    </nav>
    
    <div class="loading-project" id="loadingProject">
        <h2 data-i18n="common.loading">Loading CFSS Project...</h2>
        <p data-i18n="common.loadingProjectDetails">Please wait while we load the project details.</p>
    </div>
    
    <div class="auth-error" id="authError" style="display: none;">
        <h2 data-i18n="common.authRequired">Authentication Required</h2>
        <p data-i18n="cfss.loginToViewDetails">Please log in to view CFSS project details.</p>
        <button onclick="window.location.href='auth.html'" data-i18n="common.goToLogin">Go to Login</button>
    </div>
    
    <div class="access-denied" id="accessDenied" style="display: none;">
        <h2 data-i18n="common.accessDenied">Access Denied</h2>
        <p data-i18n="cfss.noPermissionToView">You don't have permission to view this CFSS project.</p>
        <button onclick="window.location.href='cfss-dashboard.html'" data-i18n="cfss.backToDashboard">Back to CFSS Dashboard</button>
    </div>
    
    <div class="container" id="projectContainer" style="display: none;">
        <!-- Page-level tabs (only shown for interior-system projects with rooms) -->
        <div class="page-tabs" id="pageTabs" style="display: none;">
            <button class="page-tab-btn active" data-page-tab="cfss">
                <i class="fas fa-th-large"></i> CFSS
            </button>
            <button class="page-tab-btn" data-page-tab="seismic-ceiling">
                <i class="fas fa-building"></i> Seismic Ceiling
            </button>
        </div>

        <!-- Top Half split into two horizontal sections -->
        <div class="top-half" id="cfssTopHalf">
            <div class="left-section">
                <h1 data-i18n="cfss.projectDetails">CFSS Project Details</h1>

                <!-- Basic Information (Always Visible) -->
                <div class="basic-info">
                    <p><strong data-i18n="project.projectName">Project Name:</strong> <span id="projectName"></span></p>
                    <p><strong data-i18n="project.projectNumber">Project Number:</strong> <span id="projectNumber"></span></p>
                    <p><strong data-i18n="project.clientName">Client Name:</strong> <span id="clientName"></span></p>
                    <p><strong data-i18n="project.clientEmails">Client Email(s):</strong> <span id="clientEmails"></span></p>
                    <p><strong data-i18n="project.description">Description:</strong> <span id="projectDescription"></span></p>
                    <p><strong data-i18n="project.type">Type:</strong> <span id="projectType"></span></p>
                    <p><strong data-i18n="project.status">Status:</strong>
                        <select id="projectStatusDropdown">
                            <option value="Planning" data-i18n="status.planning">Planning</option>
                            <option value="In Progress" data-i18n="status.inProgress">In Progress</option>
                            <option value="Completed" data-i18n="status.completed">Completed</option>
                        </select>
                    </p>
                    <p><strong data-i18n="project.address">Address:</strong> <span id="projectAddress"></span></p>
                    <p><strong data-i18n="cfss.deflectionMax">Deflection Max:</strong> <span id="projectDeflectionMax"></span></p>
                    <p><strong data-i18n="cfss.thicknessMin">Thickness Min:</strong> <span id="projectThicknessMin"></span></p>
                    <p><strong data-i18n="project.designedBy">Designed by:</strong> <span id="projectDesignedBy"></span></p>
                    <p><strong data-i18n="project.approvedBy">Approved by:</strong> <span id="projectApprovedBy"></span></p>
                </div>

                <!-- CFSS Data Display (shows saved data) -->
                <div id="cfssDataDisplay" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                    <h3 style="margin: 0 0 10px 0; color: #17a2b8; font-size: 16px;" data-i18n="cfss.windData">CFSS Wind Data</h3>
                    <div id="cfssDataContent">
                        <!-- CFSS data will be populated here by JavaScript -->
                    </div>
                </div>

                <div id="projectOwnerInfo">
                    <!-- Owner info will be populated for admins -->
                </div>

                <!-- Project Files Section -->
                <div class="files-section" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 2px solid #17a2b8; padding-bottom: 5px;">
                        <h4 style="margin: 0; color: #17a2b8; font-size: 14px;" data-i18n="cfss.projectFiles">Project Files</h4>
                        <button id="showUploadFileBtn" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-plus"></i>
                            <span data-i18n="common.uploadFile">Upload File</span>
                        </button>
                    </div>

                    <div id="uploadFileRow" style="display: none; background: #e8f5f7; padding: 15px; border-radius: 5px; margin-bottom: 15px; border: 2px dashed #17a2b8;">
                        <!-- Toggle Pills -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 12px; font-weight: 500; color: #333;" data-i18n="cfss.source">Source:</span>
                            <div style="display: inline-flex; background: #d4d4d4; border-radius: 6px; padding: 3px;">
                                <button type="button" id="uploadModeFile" class="upload-mode-btn active" style="padding: 6px 14px; font-size: 12px; border: none; border-radius: 4px; cursor: pointer; background: #17a2b8; color: white; transition: all 0.2s;" data-i18n="common.uploadFile">
                                    Upload File
                                </button>
                                <button type="button" id="uploadModeLink" class="upload-mode-btn" style="padding: 6px 14px; font-size: 12px; border: none; border-radius: 4px; cursor: pointer; background: transparent; color: #555; transition: all 0.2s;" data-i18n="cfss.pasteLink">
                                    Paste Link
                                </button>
                            </div>
                        </div>
                        <!-- Input Row -->
                        <div style="display: flex; gap: 15px; align-items: flex-end;">
                            <div style="flex: 2;">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 5px; color: #333;">
                                    <span data-i18n="cfss.fileName">File Name</span> <span style="color: red;">*</span>
                                </label>
                                <input type="text" id="uploadFileName" placeholder="Enter file name..." data-i18n-placeholder="cfss.enterFileName" style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 3px; font-size: 13px; height: 34px; box-sizing: border-box;">
                            </div>
                            <div style="flex: 3;">
                                <label id="uploadInputLabel" style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 5px; color: #333;">
                                    <span data-i18n="cfss.selectFile">Select File</span> <span style="color: red;">*</span>
                                </label>
                                <!-- File Input (shown by default) -->
                                <input type="file" id="uploadFileInput" accept="image/*,.pdf" style="width: 100%; padding: 6px 10px; border: 1px solid #ddd; border-radius: 3px; font-size: 13px; background: white; height: 34px; box-sizing: border-box;">
                                <!-- Link Input (hidden by default) -->
                                <input type="text" id="uploadLinkInput" placeholder="https://example.com/file.pdf" style="display: none; width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 3px; font-size: 13px; height: 34px; box-sizing: border-box;">
                            </div>
                            <div style="display: flex; gap: 8px; flex-shrink: 0;">
                                <button id="uploadFileSubmitBtn" style="background: #28a745; color: white; border: none; padding: 8px 14px; border-radius: 3px; cursor: pointer; font-size: 12px; white-space: nowrap; height: 34px; min-width: 80px;">
                                    <i class="fas fa-upload"></i> <span data-i18n="common.upload">Upload</span>
                                </button>
                                <button id="uploadFileCancelBtn" style="background: #6c757d; color: white; border: none; padding: 8px 14px; border-radius: 3px; cursor: pointer; font-size: 12px; height: 34px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;" id="filesTable">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #e0e0e0;">
                                <th style="text-align: left; padding: 10px; font-weight: 600; color: #333; font-size: 12px; text-transform: uppercase; width: 50%;" data-i18n="cfss.fileName">File Name</th>
                                <th style="text-align: left; padding: 10px; font-weight: 600; color: #333; font-size: 12px; text-transform: uppercase; width: 20%;" data-i18n="project.type">Type</th>
                                <th style="text-align: left; padding: 10px; font-weight: 600; color: #333; font-size: 12px; text-transform: uppercase; width: 20%;" data-i18n="common.date">Date</th>
                                <th style="text-align: center; padding: 10px; font-weight: 600; color: #333; font-size: 12px; text-transform: uppercase; width: 10%;" data-i18n="common.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filesTableBody">
                            <!-- Files will be populated here -->
                        </tbody>
                    </table>

                    <div id="filesEmptyState" style="display: none; text-align: center; padding: 50px; color: #999;">
                        <i class="fas fa-folder-open" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
                        <p style="margin: 0;" data-i18n="cfss.noFilesUploaded">No files uploaded yet. Click "Upload File" to add files.</p>
                    </div>
                </div>
            </div>
            <div class="right-section">
                <!-- NEW: Tab Interface -->
                <div class="tab-header">
                    <button class="tab-button active" data-tab="option-list">
                        <i class="fas fa-cogs"></i>
                        <span data-i18n="cfss.optionList">Option List</span>
                    </button>
                    <button class="tab-button" data-tab="wall-list">
                        <i class="fas fa-th-large"></i>
                        <span data-i18n="cfss.wallList">Wall List</span>
                    </button>
                    <button class="tab-button" data-tab="parapet-list">
                        <i class="fas fa-building"></i>
                        <span data-i18n="cfss.parapetList">Parapet List</span>
                    </button>
                    <button class="tab-button" data-tab="window-list">
                        <i class="fas fa-window-maximize"></i>
                        <span data-i18n="cfss.windowList">Window List</span>
                    </button>
                    <button class="tab-button" data-tab="soffite-list">
                        <i class="fas fa-grip-lines-vertical"></i>
                        <span data-i18n="cfss.soffitesList">Soffites List</span>
                    </button>
                    <button class="tab-button" data-tab="custom-pages">
                        <i class="fas fa-file-alt"></i>
                        <span data-i18n="cfss.customPages">Custom Pages</span>
                    </button>
                    <button class="tab-button" data-tab="review">
                        <i class="fas fa-clipboard-check"></i>
                        <span data-i18n="cfss.review">Review</span>
                    </button>
                </div>

                <div class="tab-content">
                    <!-- Wall List Tab Content -->
                    <div id="wall-list-content" class="tab-content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;" data-i18n="cfss.wallList">Wall List</h1>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-file-pdf"></i> <span data-i18n="cfss.generateReport">Generate CFSS Report</span>
                                </button>
                                <button id="generateWallDataSheetButton" class="button primary" style="background: #17a2b8;">
                                    <i class="fas fa-file-excel"></i> <span data-i18n="cfss.generateWallDataSheet">Generate Wall Data Sheet</span>
                                </button>
                                <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                                    <i class="fas fa-paper-plane"></i> <span data-i18n="cfss.sendReportToClients">Send Report to Client(s)</span>
                                </button>
                            </div>
                        </div>
                        <div class="selection-summary" id="wallSelectionSummary">
                            <i class="fas fa-th-large"></i> <span data-i18n="cfss.wallsAdded">0 walls added</span>
                        </div>
                        <div id="equipmentList"></div>
                    </div>

                    <!-- Parapet List Tab Content -->
                    <div id="parapet-list-content" class="tab-content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;" data-i18n="cfss.parapetList">Parapet List</h1>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-file-pdf"></i> <span data-i18n="cfss.generateReport">Generate CFSS Report</span>
                                </button>
                                <button id="generateWallDataSheetButton" class="button primary" style="background: #17a2b8;">
                                    <i class="fas fa-file-excel"></i> <span data-i18n="cfss.generateWallDataSheet">Generate Wall Data Sheet</span>
                                </button>
                                <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                                    <i class="fas fa-paper-plane"></i> <span data-i18n="cfss.sendReportToClients">Send Report to Client(s)</span>
                                </button>
                            </div>
                        </div>
                        <div class="selection-summary" id="parapetSelectionSummary">
                            <i class="fas fa-building"></i> <span data-i18n="cfss.parapetsAdded">0 parapets added</span>
                        </div>
                        <div id="parapetList" class="equipment-list">
                            <!-- Parapets will be displayed here -->
                        </div>
                    </div>

                    <!-- Options List Tab Content -->
                    <div id="option-list-content" class="tab-content-section active">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;" data-i18n="cfss.optionList">Option List</h1>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-file-pdf"></i> <span data-i18n="cfss.generateReport">Generate CFSS Report</span>
                                </button>
                                <button id="generateWallDataSheetButton" class="button primary" style="background: #17a2b8;">
                                    <i class="fas fa-file-excel"></i> <span data-i18n="cfss.generateWallDataSheet">Generate Wall Data Sheet</span>
                                </button>
                                <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                                    <i class="fas fa-paper-plane"></i> <span data-i18n="cfss.sendReportToClients">Send Report to Client(s)</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="selection-summary" id="selectionSummary">
                            <i class="fas fa-check-circle"></i> <span data-i18n="cfss.optionsSelected">0 options selected</span>
                        </div>

                        <!-- Category 1: Lisse Trouée -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-grip-lines"></i>
                                Lisse Trouée
                            </div>
                            <div id="lisse-trouee-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 2: Double Lisse -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-equals"></i>
                                Double Lisse
                            </div>
                            <div id="double-lisse-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 3: Lisse Basse -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-minus"></i>
                                Lisse Basse
                            </div>
                            <div id="lisse-basse-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 4: Parapet -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-building"></i>
                                Parapet
                            </div>
                            <div id="parapet-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 5: Fenêtre -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-window-restore"></i>
                                Fenêtre
                            </div>
                            <div id="fenetre-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 6: Jambages, Linteaux & Seuils -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-th-large"></i>
                                Jambages, Linteaux & Seuils
                            </div>
                            <div id="jambages-linteaux-seuils-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div id="window-list-content" class="tab-content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h1 style="margin: 0;" data-i18n="cfss.windowList">Window List</h1>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                                <i class="fas fa-file-pdf"></i> <span data-i18n="cfss.generateReport">Generate CFSS Report</span>
                            </button>
                            <button id="generateWallDataSheetButton" class="button primary" style="background: #17a2b8;">
                                <i class="fas fa-file-excel"></i> <span data-i18n="cfss.generateWallDataSheet">Generate Wall Data Sheet</span>
                            </button>
                            <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                                <i class="fas fa-paper-plane"></i> <span data-i18n="cfss.sendReportToClients">Send Report to Client(s)</span>
                            </button>
                        </div>
                    </div>
                    <div class="selection-summary" id="windowSelectionSummary" style="margin-bottom: 20px;">
                        <i class="fas fa-window-maximize"></i> <span data-i18n="cfss.windowsAdded">0 windows added</span>
                    </div>
                    <div id="windowList" class="equipment-list">
                        <!-- Windows will be displayed here -->
                    </div>
                </div>

                <!-- Soffites List Tab Content -->
                <div id="soffite-list-content" class="tab-content-section">
                    <!-- View 1: Soffites List -->
                    <div id="soffitesListView">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;" data-i18n="cfss.soffitesList">Soffites List</h1>
                            <button id="toggleSoffitesViewButton" class="button primary" style="background: #6f42c1;" onclick="toggleSoffitesView()">
                                <i class="fas fa-file-alt"></i> <span data-i18n="cfss.soffitesPages">Soffites Pages</span>
                            </button>
                        </div>
                        <div class="selection-summary" id="soffiteSelectionSummary" style="margin-bottom: 20px;">
                            <i class="fas fa-grip-lines-vertical"></i> <span data-i18n="cfss.soffitesAdded">0 soffites added</span>
                        </div>
                        <div id="soffiteList" class="equipment-list">
                            <!-- Soffites will be displayed here -->
                        </div>
                    </div>

                    <!-- View 2: Soffites Pages List -->
                    <div id="soffitesPagesView" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;" data-i18n="cfss.soffitesPages">Soffites Pages</h1>
                            <div style="display: flex; gap: 10px;">
                                <button id="backToSoffitesListButton" class="button secondary" onclick="toggleSoffitesView()">
                                    <i class="fas fa-arrow-left"></i> <span data-i18n="cfss.soffitesList">Soffites List</span>
                                </button>
                                <button id="addSoffitesPageButton" class="button primary" style="background: #007bff;" onclick="showSoffitesPageBuilder()">
                                    <i class="fas fa-plus"></i> <span data-i18n="cfss.addSoffitesPage">Add Soffites Page</span>
                                </button>
                            </div>
                        </div>
                        <div class="selection-summary success" id="soffitesPagesSelectionSummary" style="margin-bottom: 20px;">
                            <i class="fas fa-file-alt"></i> <span data-i18n="cfss.soffitesPagesAdded">0 soffites pages added</span>
                        </div>
                        <div id="soffitesPagesList" style="margin-bottom: 30px;">
                            <!-- Soffites pages will be listed here -->
                        </div>
                    </div>

                    <!-- Soffites Custom Page Builder (Hidden by default) -->
                    <div id="soffitesPageBuilder" style="display: none;">
                        <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <input type="text" id="soffitesPageTitle" placeholder="Page Title" data-i18n-placeholder="cfss.pageTitle"
                                    style="flex: 1; padding: 10px; font-size: 16px; border: 1px solid #dee2e6; border-radius: 4px; margin-right: 15px;">
                                <button onclick="saveSoffitesPage()" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-save"></i> <span data-i18n="cfss.savePage">Save Page</span>
                                </button>
                                <button onclick="cancelSoffitesPageEdit()" class="button secondary" style="margin-left: 10px;">
                                    <i class="fas fa-times"></i> <span data-i18n="common.cancel">Cancel</span>
                                </button>
                            </div>
                            
                            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                                <!-- Left: Element Palette -->
                                <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                    <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;" data-i18n="cfss.addElements">Add Elements</h3>
                                    <div id="soffitesElementPalette" style="display: flex; gap: 10px;">
                                        <div class="palette-item soffites-palette-item" draggable="true" data-type="heading" style="flex: 1;">
                                            <i class="fas fa-heading"></i>
                                            <span data-i18n="cfss.heading">Heading</span>
                                        </div>
                                        <div class="palette-item soffites-palette-item" draggable="true" data-type="text" style="flex: 1;">
                                            <i class="fas fa-paragraph"></i>
                                            <span data-i18n="cfss.textBlock">Text Block</span>
                                        </div>
                                        <div class="palette-item soffites-palette-item" draggable="true" data-type="image" style="flex: 1;">
                                            <i class="fas fa-image"></i>
                                            <span data-i18n="cfss.image">Image</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right: Properties -->
                                <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                    <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;" data-i18n="cfss.properties">Properties</h3>
                                    <div id="soffitesPageProperties" class="properties-card">
                                        <p style="color: #6c757d; font-size: 13px; text-align: center; padding: 20px 10px;" data-i18n="cfss.selectElementToEdit">
                                            Select an element to edit its properties
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Bottom Section: Canvas (Full Width) -->
                            <div style="background: #e9ecef; border-radius: 8px; overflow: auto; display: flex; justify-content: center;">
                                <div id="soffitesPageCanvas" class="custom-page-canvas"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Pages Tab Content -->
                <div id="custom-pages-content" class="tab-content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h1 style="margin: 0;" data-i18n="cfss.customPages">Custom Pages</h1>
                        <button id="addCustomPageButton" class="button primary" style="background: #007bff;">
                            <i class="fas fa-plus"></i> <span data-i18n="cfss.addCustomPage">Add Custom Page</span>
                        </button>
                    </div>
                    
                    <!-- Selection summary (green bar) -->
                    <div class="selection-summary success" id="customPagesSelectionSummary" style="margin-bottom: 20px;">
                    <i class="fas fa-file-alt"></i> <span data-i18n="cfss.customPagesAdded">0 custom pages added</span>
                    </div>

                    <!-- Custom Pages List -->
                    <div id="customPagesList" style="margin-bottom: 30px;">
                        <!-- Pages will be listed here -->
                    </div>
                    
                    <!-- Custom Page Builder (Hidden by default) -->
                    <div id="customPageBuilder" style="display: none;">
                        <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <input type="text" id="customPageTitle" placeholder="Page Title" data-i18n-placeholder="cfss.pageTitle"
                                    style="flex: 1; padding: 10px; font-size: 16px; border: 1px solid #dee2e6; border-radius: 4px; margin-right: 15px;">
                                <button onclick="saveCustomPage()" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-save"></i> <span data-i18n="cfss.savePage">Save Page</span>
                                </button>
                                <button onclick="cancelCustomPageEdit()" class="button secondary" style="margin-left: 10px;">
                                    <i class="fas fa-times"></i> <span data-i18n="common.cancel">Cancel</span>
                                </button>
                            </div>
                            
<div style="display: flex; gap: 20px; margin-bottom: 20px;">
    <!-- Left: Element Palette -->
    <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
        <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;" data-i18n="cfss.addElements">Add Elements</h3>
        <div id="elementPalette" style="display: flex; gap: 10px;">
            <div class="palette-item" draggable="true" data-type="heading" style="flex: 1;">
                <i class="fas fa-heading"></i>
                <span data-i18n="cfss.heading">Heading</span>
            </div>
            <div class="palette-item" draggable="true" data-type="text" style="flex: 1;">
                <i class="fas fa-paragraph"></i>
                <span data-i18n="cfss.textBlock">Text Block</span>
            </div>
            <div class="palette-item" draggable="true" data-type="image" style="flex: 1;">
                <i class="fas fa-image"></i>
                <span data-i18n="cfss.image">Image</span>
            </div>
        </div>
    </div>

    <!-- Right: Properties -->
    <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
        <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;" data-i18n="cfss.properties">Properties</h3>
        <div id="customPageProperties" class="properties-card">
            <p style="color: #6c757d; font-size: 13px; text-align: center; padding: 20px 10px;" data-i18n="cfss.selectElementToEdit">
                Select an element to edit its properties
            </p>
        </div>
    </div>
</div>

<!-- Bottom Section: Canvas (Full Width) -->
<div style="background: #e9ecef; border-radius: 8px; overflow: auto; display: flex; justify-content: center;">
    <!-- PDF-sized canvas: 8.5" x 11" ratio (850px x 1100px) -->
    <div id="customPageCanvas" class="custom-page-canvas">
</div>
        <div class="canvas-empty-state">
        </div>
    </div>
</div>
                        </div>
                    </div>
<!-- Review Tab Content -->
<div id="review-content" class="tab-content-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1 style="margin: 0;" data-i18n="cfss.review">Review</h1>
        <div style="display:flex; gap:10px; align-items:center;">
            <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                <i class="fas fa-file-pdf"></i> <span data-i18n="cfss.generateReport">Generate CFSS Report</span>
            </button>
            <button id="generateWallDataSheetButton" class="button primary" style="background: #17a2b8;">
                <i class="fas fa-file-excel"></i> <span data-i18n="cfss.generateWallDataSheet">Generate Wall Data Sheet</span>
            </button>
            <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                <i class="fas fa-paper-plane"></i> <span data-i18n="cfss.sendReportToClients">Send Report to Client(s)</span>
            </button>
        </div>
    </div>
    
    <div class="summary-header" id="reviewSummary">
        <i class="fas fa-clipboard-check"></i>
        <span data-i18n="common.loading">Loading...</span>
    </div>

                        <!-- Walls Section -->
                        <div class="review-category-section">
                            <div class="category-header">
                                <i class="fas fa-th-large"></i>
                                <span id="reviewWallsHeader" data-i18n="cfss.reviewWalls">Walls (0)</span>
                            </div>
                            <div id="reviewWallsTable"></div>
                        </div>

                        <!-- Parapets Section -->
                        <div class="review-category-section">
                            <div class="category-header">
                                <i class="fas fa-building"></i>
                                <span id="reviewParapetsHeader" data-i18n="cfss.reviewParapets">Parapets (0)</span>
                            </div>
                            <div id="reviewParapetsTable"></div>
                        </div>

                        <!-- Options Section -->
                        <div class="review-category-section">
                            <div class="category-header">
                                <i class="fas fa-cogs"></i>
                                <span id="reviewOptionsHeader" data-i18n="cfss.reviewOptions">Selected Options (0)</span>
                            </div>
                            <div id="reviewOptionsTable"></div>
                        </div>

                        <!-- Windows Section -->
                        <div class="review-category-section">
                            <div class="category-header">
                                <i class="fas fa-window-maximize"></i>
                                <span id="reviewWindowsHeader" data-i18n="cfss.reviewWindows">Windows (0)</span>
                            </div>
                            <div id="reviewWindowsTable"></div>
                        </div>

                        <!-- Custom Pages Section -->
                        <div class="review-category-section">
                            <div class="category-header">
                                <i class="fas fa-file-alt"></i>
                                <span id="reviewCustomPagesHeader" data-i18n="cfss.reviewCustomPages">Custom Pages (0)</span>
                            </div>
                            <div id="reviewCustomPagesTable"></div>
                        </div>
                    </div>
                </div>
                
                <div class="save-options-btn" id="saveOptionsBtnContainer" style="display: none;">
                    <button class="save-btn" id="saveOptionsBtn">
                        <i class="fas fa-save"></i>
                        <span data-i18n="cfss.saveOptions">Save Options</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Bottom Half for Wall Details -->
        <div class="bottom-half" id="cfssBottomHalf">
            <div class="cfss-data-section">
                <button class="cfss-btn" onclick="toggleCFSSForm()">
                    <i class="fas fa-plus"></i>
                    <span id="cfss-btn-text" data-i18n="cfss.addCFSSData">Add CFSS Data</span>
                </button>
                
                <div id="cfss-form" class="cfss-form hidden">
                    <!-- Global Wind Calculation Parameters -->
                    <div class="wind-parameters-section">
                        <h3 style="margin: 0 0 15px 0; color: #17a2b8; font-size: 16px; border-bottom: 2px solid #17a2b8; padding-bottom: 8px;">
                            Paramètres de calcul du vent
                        </h3>
                        
                        <div class="wind-params-grid">
                            <div class="field-row">
                                <label for="q50">q50 (kPa):</label>
                                <input type="number" id="q50" class="number-input" step="0.01" min="0" oninput="recalculateAllStoreys()">
                            </div>
                            
                            <div class="field-row">
                                <label for="importanceFactor">Facteur d'importance (Iw):</label>
                                <select id="importanceFactor" class="select-input" onchange="recalculateAllStoreys()">
                                    <option value="" data-i18n="common.selectOption">-- Sélectionner --</option>
                                    <option value="Low">Low (0.8)</option>
                                    <option value="Normal">Normal (1.0)</option>
                                    <option value="High">High (1.15)</option>
                                    <option value="Post Disaster">Post Disaster (1.25)</option>
                                </select>
                            </div>
                            
                            <div class="field-row">
                                <label for="terrainType">Type de terrain:</label>
                                <select id="terrainType" class="select-input" onchange="recalculateAllStoreys()">
                                    <option value="" data-i18n="common.selectOption">-- Sélectionner --</option>
                                    <option value="Open terrain">Open terrain</option>
                                    <option value="Rough terrain">Rough terrain</option>
                                </select>
                            </div>
                            
                            <div class="field-row">
                                <label for="category">Catégorie (pression interne):</label>
                                <select id="category" class="select-input" onchange="recalculateAllStoreys()">
                                    <option value="" data-i18n="common.selectOption">-- Sélectionner --</option>
                                    <option value="Category 1">Category 1</option>
                                    <option value="Category 2">Category 2</option>
                                    <option value="Category 3">Category 3</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Storey Calculations Section -->
                    <div class="storey-calculations-section">
                        <h3 style="margin: 20px 0 15px 0; color: #17a2b8; font-size: 16px; border-bottom: 2px solid #17a2b8; padding-bottom: 8px;">
                            Calculs par étage
                        </h3>
                        
                        <div class="storey-table-container">
                            <table class="storey-table" id="storeyTable">
                                <thead>
                                    <tr>
                                        <th>Étage</th>
                                        <th>H (m)</th>
                                        <th>A (m²)</th>
                                        <th>ULS (psf)</th>
                                        <th>SLS (psf)</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="storeyTableBody">
                                    <!-- Storey rows will be added dynamically -->
                                </tbody>
                            </table>
                        </div>
                        
                        <button class="add-section-btn" onclick="addStoreyRow()">
                            <i class="fas fa-plus"></i> <span data-i18n="cfss.addNewFloor">Add new floor</span>
                        </button>
                    </div>
                    
                    <!-- Project-wide fields (single instance) -->
                    <div class="project-fields">
                        <div class="field-row">
                            <label>La déflexion maximale permise pour les éléments d'ossature extérieure:</label>
                            <input type="text" id="maxDeflection" class="text-input" placeholder="Enter max deflection" data-i18n-placeholder="cfss.enterMaxDeflection">
                        </div>
                        
                        <div class="field-row">
                            <label>La distance maximale  entre les entretoises:</label>
                            <input type="text" id="maxSpacing" class="text-input" placeholder="Enter max spacing" data-i18n-placeholder="cfss.enterMaxSpacing">
                        </div>
                        
                        <div class="field-row">
                            <label>Assemblage des éléments d'ossature entre eux:</label>
                            <input type="text" id="framingAssembly" class="text-input" placeholder="Enter framing assembly" data-i18n-placeholder="cfss.enterFramingAssembly">
                        </div>
                        
                        <div class="field-row">
                            <label>Ancrage des lisses au béton:</label>
                            <input type="text" id="concreteAnchor" class="text-input" placeholder="Enter concrete anchor" data-i18n-placeholder="cfss.enterConcreteAnchor">
                        </div>
                        
                        <div class="field-row">
                            <label>Ancrage des lisses à l'acier:</label>
                            <input type="text" id="steelAnchor" class="text-input" placeholder="Enter steel anchor" data-i18n-placeholder="cfss.enterSteelAnchor">
                        </div>
                
                    <!-- Save Button -->
                    <button class="save-cfss-btn" onclick="saveCFSSData()">
                        <i class="fas fa-save"></i> <span data-i18n="cfss.saveCFSSData">Save CFSS Data</span>
                    </button>
                </div>
            </div>
            
            <button id="newCalculationButton" style="display: block !important; margin: 20px 0;"><i class="fas fa-th-large"></i> <span data-i18n="cfss.addWall">Add Wall</span></button>

            <button id="addParapetButton" class="button secondary">
                <i class="fas fa-building"></i> <span data-i18n="cfss.addParapet">Add Parapet</span>
            </button>

            <button id="addWindowButton" class="button secondary">
                <i class="fas fa-window-maximize"></i> <span data-i18n="cfss.addWindow">Add Window</span>
            </button>

            <button id="exteriorWallCalcButton" class="button secondary">
                <i class="fas fa-calculator"></i> <span data-i18n="cfss.exteriorWallCalc">Exterior Wall Calculation</span>
            </button>

<!-- Exterior Wall Calculation Form -->
<div id="exteriorWallForm" class="equipment-form">
    <h3 data-i18n="cfss.exteriorWallCalc">Exterior Wall Calculation</h3>
    <div style="display: flex; gap: 30px;">
        <!-- Left side: Form -->
        <div style="flex: 0 0 400px;">
            <form id="exteriorWallDataForm">
                <!-- Windload -->
                <div class="form-group">
                    <label for="wallWindloadULS" data-i18n="cfss.windloadResistanceULS">Windload Resistance (ULS) (psf)</label>
                    <input type="number" id="wallWindloadULS" name="wallWindloadULS" step="0.01" value="5" required>
                </div>

                <!-- Spacing -->
                <div class="form-group">
                    <label for="wallSpacing" data-i18n="cfss.spacingIn">Spacing (in)</label>
                    <select id="wallSpacing" name="wallSpacing" required>
                        <option value="8">8</option>
                        <option value="12">12</option>
                        <option value="16" selected>16</option>
                        <option value="24">24</option>
                    </select>
                </div>

                <!-- Bridging Spacing -->
                <div class="form-group">
                    <label for="wallBridging" data-i18n="cfss.bridgingSpacingIn">Bridging Spacing (in)</label>
                    <select id="wallBridging" name="wallBridging" required>
                        <option value="48" selected>48</option>
                        <option value="60">60</option>
                        <option value="72">72</option>
                        <option value="96">96</option>
                    </select>
                </div>

                <!-- Deflection Limit -->
                <div class="form-group">
                    <label for="wallDeflectionLimit" data-i18n="cfss.deflectionLimit">Deflection Limit (L/)</label>
                    <select id="wallDeflectionLimit" name="wallDeflectionLimit" required>
                        <option value="180">180</option>
                        <option value="240" selected>240</option>
                        <option value="360">360</option>
                        <option value="480">480</option>
                        <option value="600">600</option>
                        <option value="720">720</option>
                    </select>
                </div>

                <!-- Height -->
                <div class="form-group">
                    <label for="wallHeightFt" data-i18n="cfss.height">Height</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="wallHeightFt" name="wallHeightFt" placeholder="ft" value="10" required style="flex: 1;">
                        <span>ft</span>
                        <input type="number" id="wallHeightIn" name="wallHeightIn" placeholder="in" value="1" required style="flex: 1;">
                        <span>in</span>
                    </div>
                </div>

                <!-- Bearing Length -->
                <div class="form-group">
                    <label for="wallBearingLength" data-i18n="cfss.bearingLengthIn">Bearing Length (N) (in)</label>
                    <input type="number" id="wallBearingLength" name="wallBearingLength" step="0.1" value="1" required>
                </div>

                <!-- Fastener Type -->
                <div class="form-group">
                    <label for="wallFastenerType" data-i18n="cfss.fastenerType">Fastener Type</label>
                    <select id="wallFastenerType" name="wallFastenerType" required>
                        <option value="EOF">EOF</option>
                        <option value="IOF">IOF</option>
                        <option value="ETF">ETF</option>
                        <option value="ITF">ITF</option>
                    </select>
                </div>

                <!-- Steel Stud -->
                <div class="form-group">
                    <label for="wallSteelStud" data-i18n="cfss.steelStud">Steel Stud</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="wallSteelStud" name="wallSteelStud" required style="flex: 1;">
                            <option value="" data-i18n="cfss.selectSteelStud">Select Steel Stud...</option>
                        </select>
                        <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap; margin: 0;">
                            <input type="checkbox" id="wallDosADos" name="wallDosADos" style="margin: 0;">
                            <span>dos-à-dos</span>
                        </label>
                    </div>
                </div>

                <!-- Bottom Track -->
                <div class="form-group">
                    <label for="wallBottomTrack" data-i18n="cfss.bottomTrack">Bottom Track</label>
                    <select id="wallBottomTrack" name="wallBottomTrack" required>
                        <option value="" data-i18n="cfss.selectBottomTrack">Select Bottom Track...</option>
                    </select>
                </div>

                <!-- Deflection Track -->
                <div class="form-group">
                    <label for="wallDeflectionTrack" data-i18n="cfss.deflectionTrack">Deflection Track</label>
                    <select id="wallDeflectionTrack" name="wallDeflectionTrack" required>
                        <option value="" data-i18n="cfss.selectDeflectionTrack">Select Deflection Track...</option>
                    </select>
                </div>

                <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="button success">
                <i class="fas fa-save"></i> <span data-i18n="cfss.saveWindow">Save Window</span>
            </button>
        </div>
    </form>
</div>

        <!-- Right side: Results -->
        <div style="flex: 1; min-width: 0;">
            <div id="wallCalcResults" class="calc-results" style="display: none;">
                <h3 data-i18n="cfss.calculationResults">Calculation Results</h3>
                <div id="wallCalcResultsContent"></div>
            </div>
        </div>
    </div>
</div>

            <div id="equipmentForm">
                <div class="calculation-sections">
                    <!-- Section 1: Wall Form -->
                    <div class="equipment-form-section">
                        <!-- Form Fields (Left side within the section) -->
                        <div class="form-fields">
                            <h2 data-i18n="cfss.newWall">New Wall</h2>
                            <form id="equipmentFormElement">
                                <!-- 1. Wall Name -->
                            <div class="form-group">
                                <label for="equipment" data-i18n="cfss.wallName">Wall Name:</label>
                                <input type="text" id="equipment" name="equipment" placeholder="Enter wall name..." data-i18n-placeholder="cfss.enterWallName" required>
                            </div>

                            <!-- Cladding Fields - Two Column Grid -->
                                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                            <div class="form-group" style="margin-bottom: 0; width: 200px;">
                                <label for="claddingType" data-i18n="cfss.claddingType">Cladding Type:</label>
                                <select id="claddingType" name="claddingType">
                                    <option value="" data-i18n="cfss.selectCladdingType">Select cladding type...</option>
                                    <option value="Metal">Metal</option>
                                    <option value="Brick">Brick</option>
                                    <option value="Stone">Stone</option>
                                    <option value="Steel">Steel</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0; width: 200px;">
                                <label for="claddingWeightSupport" data-i18n="cfss.weightSupportByStud">Weight Support by Stud:</label>
                                <select id="claddingWeightSupport" name="claddingWeightSupport">
                                    <option value="" data-i18n="common.select">Select...</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                    <option value="N/A">N/A</option>
                                    <option value="Unknown">Unknown</option>
                                </select>
                            </div>
                        </div>

                                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                        <div class="form-group" style="margin-bottom: 0; width: 200px;">
                            <label for="claddingWeight" data-i18n="cfss.claddingWeight">Cladding Weight (psf):</label>
                            <input type="number" id="claddingWeight" name="claddingWeight" placeholder="Enter weight..." data-i18n-placeholder="cfss.enterWeight" step="0.1" min="0">
                        </div>
                        <div class="form-group" style="margin-bottom: 0; width: 200px;">
                            <label for="thermoclip" data-i18n="cfss.thermoclip">Thermoclip:</label>
                            <select id="thermoclip" name="thermoclip" onchange="toggleThermoclipFields()">
                                <option value="" data-i18n="common.select">Select...</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="N/A">N/A</option>
                                <option value="Unknown">Unknown</option>
                            </select>
                        </div>
                    </div>

                            <!-- Thermoclip Details (conditionally shown) -->
                            <div id="thermoclipDetails" style="display: none; background: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #92400e;" data-i18n="cfss.thermoclipDetails">Thermoclip Details</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label for="thermoclipModel" style="font-size: 13px;" data-i18n="cfss.model">Model:</label>
                                        <input type="text" id="thermoclipModel" name="thermoclipModel" placeholder="Enter model..." data-i18n-placeholder="cfss.enterModel" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                <label for="thermoclipSpacingV" style="font-size: 13px;" data-i18n="cfss.spacingVerticalIn">Spacing Vertical (in):</label>
                                <input type="text" id="thermoclipSpacingV" name="thermoclipSpacingV" list="spacingOptions" placeholder="Select or type..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="thermoclipSpacingH" style="font-size: 13px;" data-i18n="cfss.spacingHorizontalIn">Spacing Horizontal (in):</label>
                                <input type="text" id="thermoclipSpacingH" name="thermoclipSpacingH" list="spacingOptions" placeholder="Select or type..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            </div>

                            <!-- Datalist for spacing options (shared by both fields) -->
                            <datalist id="spacingOptions">
                                <option value="12">
                                <option value="16">
                                <option value="24">
                                <option value="32">
                                <option value="48">
                            </datalist>
                                </div>
                            </div>

                            <!-- 2. Floor -->
                                <div class="form-group">
                                    <label for="floor" data-i18n="cfss.floor">Floor:</label>
                                    <div style="display: flex; gap: 15px; align-items: center;">
                                        <input type="text" id="floor" name="floor" placeholder="Enter floor..." data-i18n-placeholder="cfss.enterFloor" required style="flex: 1;">
                                        <div style="display: flex; gap: 15px; font-size: 13px; color: #666;">
                                            <span style="padding: 4px 8px; background: #e7f5e9; border-radius: 4px; min-width: 80px;">
                                                <strong style="color: #28a745;">ULS:</strong> <span id="floorULSDisplay">--</span>
                                            </span>
                                            <span style="padding: 4px 8px; background: #d1ecf1; border-radius: 4px; min-width: 80px;">
                                                <strong style="color: #17a2b8;">SLS:</strong> <span id="floorSLSDisplay">--</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 3. Hauteur Max - MANUAL INPUT WITH UNIT SELECTION -->
                                <div class="form-group">
                                    <label for="hauteurMax">Hauteur Max:</label>
                                        <div class="hauteur-row" style="display: flex; gap: 10px; align-items: center;">
                                        <input
                                            type="number"
                                            id="hauteurMax"
                                            name="hauteurMax"
                                            min="0"
                                            step="1"
                                            required
                                        >
                                        <input
                                            type="text"
                                            id="hauteurMaxMinor"
                                            name="hauteurMaxMinor"
                                            placeholder=""
                                        >
                                        <select
                                            id="hauteurMaxUnit"
                                            name="hauteurMaxUnit"
                                            required
                                            onchange="toggleMinorField('hauteur')"
                                        >
                                            <option value="ft-in" selected>ft-in</option>
                                            <option value="mm">mm</option>
                                        </select>
                                    </div>
                                    <div id="hauteurPreview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
                                        Preview: --
                                    </div>
                                </div>

<!-- Dual Set Container -->
<div id="dualSetContainer" style="position: relative;">
    <!-- Set 1 and Set 2 Container -->
    <div id="setsWrapper" style="display: flex; gap: 20px;">
        
        <!-- SET 1 -->
        <div id="set1" style="flex: 1; min-width: 0;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 1</h4>
                <button type="button" id="addSet2Btn" onclick="toggleSet2(true)" 
                        style="background: #28a745; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    +
                </button>
            </div>
            <!-- 5. Montant Métallique with dos-à-dos checkbox -->
            <div class="form-group">
                <label for="montantMetallique">Montant Métallique:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="montantMetallique" name="montantMetallique" required style="flex: 1;">
                        <option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>
                    </select>
                    <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap; margin: 0;">
                        <input type="checkbox" id="dosADos" name="dosADos" style="margin: 0;">
                        <span>dos-à-dos</span>
                    </label>
                </div>
            </div>

            <!-- Déflexion Max -->
            <div class="form-group">
                <label for="deflexionMax">Déflexion Max:</label>
                <select id="deflexionMax" name="deflexionMax" required>
                    <option value="">Select déflexion max...</option>
                    <option value="L/180">L/180</option>
                    <option value="L/240">L/240</option>
                    <option value="L/360" selected>L/360</option>
                    <option value="L/480">L/480</option>
                    <option value="L/600">L/600</option>
                    <option value="L/720">L/720</option>
                </select>
            </div>

            <!-- 9. Espacement - DROPDOWN -->
            <div class="form-group">
                <label for="espacement">Espacement:</label>
                <select id="espacement" name="espacement" required>
                    <option value="">Select espacement...</option>
                    <option value="8&quot;c/c">8"c/c</option>
                    <option value="12&quot;c/c">12"c/c</option>
                    <option value="16&quot;c/c" selected>16"c/c</option>
                    <option value="24&quot;c/c">24"c/c</option>
                </select>
            </div>

            <!-- 6. Lisse Supérieure - AUTO-POPULATED BUT EDITABLE -->
            <div class="form-group">
                <label for="lisseSuperieure">Lisse Supérieure:</label>
                <input type="text" id="lisseSuperieure" name="lisseSuperieure" placeholder="Will be auto-filled based on montant selection..." required>
            </div>

            <!-- 7. Lisse Inférieure - AUTO-POPULATED BUT EDITABLE -->
            <div class="form-group">
                <label for="lisseInferieure">Lisse Inférieure:</label>
                <input type="text" id="lisseInferieure" name="lisseInferieure" placeholder="Will be auto-filled based on montant selection..." required>
            </div>

            <!-- 8. Entremise - NOW A DROPDOWN -->
            <div class="form-group">
                <label for="entremise">Entremise:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="entremisePart1" name="entremisePart1" required style="flex: 1;">
                        <option value="">Select...</option>
                        <option value="150U50-43" selected>150U50-43</option>
                        <option value="150U50-54">150U50-54</option>
                        <option value="N/A">N/A</option>
                    </select>
                    <select id="entremisePart2" name="entremisePart2" required style="flex: 1;">
                        <option value="">Select spacing...</option>
                        <option value="48&quot;c/c" selected>48"c/c</option>
                        <option value="Mi-hauteur">Mi-hauteur</option>
                        <option value="60&quot;c/c">60"c/c</option>
                        <option value="72&quot;c/c">72"c/c</option>
                        <option value="96&quot;c/c">96"c/c</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- SET 2 (Initially Hidden) -->
        <div id="set2" style="flex: 1; min-width: 0; display: none;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 2</h4>
                <button type="button" id="removeSet2Btn" onclick="toggleSet2(false)" 
                        style="background: #dc3545; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    ×
                </button>
            </div>

            <!-- Montant Métallique 2 -->
            <div class="form-group">
                <label for="montantMetallique2">Montant Métallique 2:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="montantMetallique2" name="montantMetallique2">
                        <option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>
                    </select>
                    <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap; margin: 0;">
                        <input type="checkbox" id="dosADos2" name="dosADos2" style="margin: 0;">
                        <span>dos-à-dos</span>
                    </label>
                </div>
            </div>

            <!-- Déflexion Max 2 -->
            <div class="form-group">
                <label for="deflexionMax2">Déflexion Max 2:</label>
                <select id="deflexionMax2" name="deflexionMax2">
                    <option value="">Select déflexion max...</option>
                    <option value="L/180">L/180</option>
                    <option value="L/240">L/240</option>
                    <option value="L/360" selected>L/360</option>
                    <option value="L/480">L/480</option>
                    <option value="L/600">L/600</option>
                    <option value="L/720">L/720</option>
                </select>
            </div>

            <!-- Espacement 2 -->
            <div class="form-group">
                <label for="espacement2">Espacement 2:</label>
                <select id="espacement2" name="espacement2">
                    <option value="">Select espacement...</option>
                    <option value="8&quot;c/c">8"c/c</option>
                    <option value="12&quot;c/c">12"c/c</option>
                    <option value="16&quot;c/c" selected>16"c/c</option>
                    <option value="24&quot;c/c">24"c/c</option>
                </select>
            </div>

            <!-- Lisse Supérieure 2 -->
            <div class="form-group">
                <label for="lisseSuperieure2">Lisse Supérieure 2:</label>
                <input type="text" id="lisseSuperieure2" name="lisseSuperieure2" placeholder="Will be auto-filled...">
            </div>

            <!-- Lisse Inférieure 2 -->
            <div class="form-group">
                <label for="lisseInferieure2">Lisse Inférieure 2:</label>
                <input type="text" id="lisseInferieure2" name="lisseInferieure2" placeholder="Will be auto-filled...">
            </div>

            <!-- Entremise 2 -->
            <div class="form-group">
                <label for="entremise2">Entremise 2:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="entremise2Part1" name="entremise2Part1" style="flex: 1;">
                        <option value="">Select...</option>
                        <option value="150U50-43" selected>150U50-43</option>
                        <option value="150U50-54">150U50-54</option>
                        <option value="N/A">N/A</option>
                    </select>
                    <select id="entremise2Part2" name="entremise2Part2" style="flex: 1;">
                        <option value="">Select spacing...</option>
                        <option value="48&quot;c/c" selected>48"c/c</option>
                        <option value="Mi-hauteur">Mi-hauteur</option>
                        <option value="60&quot;c/c">60"c/c</option>
                        <option value="72&quot;c/c">72"c/c</option>
                        <option value="96&quot;c/c">96"c/c</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

                                <div class="form-group">
                                    <label for="note" data-i18n="cfss.note">Note:</label>
                                    <input type="text" id="note" name="note" maxlength="100" placeholder="Optional note (max 100 characters)..." data-i18n-placeholder="cfss.optionalNote" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <div class="form-hint" data-i18n="cfss.max100Chars">Maximum 100 characters</div>
                                </div>
                                
                                <!-- Calculate and Save Buttons -->
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" id="calculateEquipment" style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-calculator"></i> <span data-i18n="common.calculate">Calculate</span>
                                    </button>
                                    <button type="submit" id="saveEquipment" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-save"></i> <span data-i18n="common.save">Save</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                            <!-- Image Upload Section (Right side within the section) -->
                            <!-- This will be dynamically added by JavaScript via initializeImageUpload() -->
                            
                            <input type="file" id="imageFileInput" multiple accept="image/*" style="display: none;">
                        </div>

                    <!-- Section 2: Placeholder for calculations (no calculations for CFSS) -->
                    <div class="calculation-results-section">
                        <div id="calculationResults" style="display: none;">
                            <h2 data-i18n="cfss.wallDetails">Wall Details</h2>
                            <div id="calculationResultsContent"></div>
                        </div>
                        <div id="calculationPlaceholder">
                            <h2 style="color: #666; text-align: center; margin-bottom: 10px;" data-i18n="cfss.wallDetails">Wall Details</h2>
                            <div style="text-align: center; color: #999; padding: 40px 20px;">
                                <i class="fas fa-wall-brick" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
                                <span data-i18n="cfss.fillWallInfo">Fill in wall information and click "Calculate" to preview details</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!-- Updated Window Form with Fixed Column Spacing -->
<div id="windowForm" class="equipment-form">
    <h3 data-i18n="cfss.addNewWindow">Add New Window</h3>
    <form id="windowDataForm">
    <div style="display: flex; gap: 30px; align-items: stretch;">
        <div style="flex: 1; max-width: 600px;">
        <!-- Basic Information -->
        <div class="form-group">
            <label for="windowType" data-i18n="cfss.windowType">Window Type</label>
            <input type="text" id="windowType" name="windowType" required>
        </div>

        <!-- Floor -->
        <div class="form-group">
            <label for="windowFloor" data-i18n="cfss.floor">Floor</label>
            <input type="text" id="windowFloor" name="windowFloor" placeholder="e.g., 2-5">
        </div>
        
        <!-- Largeur Max - Dual Input with Unit Toggle -->
        <div class="form-group">
            <label for="windowLargeurMax">Largeur Max</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input 
                    type="number" 
                    id="windowLargeurMax" 
                    name="windowLargeurMax" 
                    min="0"
                    step="1"
                    required 
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                >
                <input 
                    type="text" 
                    id="windowLargeurMaxMinor" 
                    name="windowLargeurMaxMinor" 
                    placeholder=""
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                >
                <select 
                    id="windowLargeurMaxUnit" 
                    name="windowLargeurMaxUnit" 
                    required 
                    onchange="toggleMinorField('windowLargeur')"
                    style="flex: 1; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                >
                    <option value="ft-in" selected>ft-in</option>
                    <option value="mm">mm</option>
                </select>
            </div>
            <div id="largeurPreview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
                Preview: --
            </div>
        </div>

        <!-- Hauteur Max - Dual Input with Unit Toggle -->
        <div class="form-group">
            <label for="windowHauteurMax">Hauteur Max</label>
            <div class="hauteur-row" style="display: flex; gap: 10px; align-items: center;">
                <input
                    type="number"
                    id="windowHauteurMax"
                    name="windowHauteurMax"
                    min="0"
                    step="1"
                    required
                >
                <input
                    type="text"
                    id="windowHauteurMaxMinor"
                    name="windowHauteurMaxMinor"
                    placeholder=""
                >
                <select
                    id="windowHauteurMaxUnit"
                    name="windowHauteurMaxUnit"
                    required
                    onchange="toggleMinorField('windowHauteur')"
                >
                    <option value="ft-in" selected>ft-in</option>
                    <option value="mm">mm</option>
                </select>
            </div>
        <div id="hauteurWindowPreview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
            Preview: --
        </div>
        </div>

        <!-- L1 Field -->
        <div class="form-group">
            <label for="windowL1">L1:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="number" id="windowL1" name="windowL1" min="0" step="1"
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <input type="text" id="windowL1Minor" name="windowL1Minor" placeholder=""
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <select id="windowL1Unit" name="windowL1Unit"
                    onchange="toggleMinorField('windowL1')"
                    style="flex: 1; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="ft-in" selected>ft-in</option>
                    <option value="mm">mm</option>
                </select>
            </div>
            <div id="l1Preview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
                Preview: --
            </div>
        </div>

        <!-- L2 Field -->
        <div class="form-group">
            <label for="windowL2">L2:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="number" id="windowL2" name="windowL2" min="0" step="1"
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <input type="text" id="windowL2Minor" name="windowL2Minor" placeholder=""
                    style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <select id="windowL2Unit" name="windowL2Unit"
                    onchange="toggleMinorField('windowL2')"
                    style="flex: 1; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="ft-in" selected>ft-in</option>
                    <option value="mm">mm</option>
                </select>
            </div>
            <div id="l2Preview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
                Preview: --
            </div>
        </div>
        </div>
        
        <!-- Window Reference Image -->
        <div style="flex: 0 0 auto; display: flex; align-self: flex-start;">
            <div style="
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: #f9f9f9;
            ">
                <img 
                    src="https://protection-sismique-equipment-images.s3.us-east-1.amazonaws.com/window-form-images/window-form-image.png" 
                    alt="Window Reference"
                    style="
                        width: 450px;
                        height: auto;
                        max-width: 100%;
                        display: block;
                        border-radius: 4px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    "
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span style="display: none; color: #999; font-size: 13px; text-align: center; padding: 20px;" data-i18n="cfss.imageNotAvailable">Image not available</span>
            </div>
        </div>
    </div>

<!-- Jambage Type section -->
<div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
    <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 10px;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="jambageType" data-i18n="cfss.jambageType">Jambage Type</label>
            <div class="type-selection-row">
                <select id="jambageType" name="jambageType" required onchange="updateTypeImage('jambage', this.value)" style="width: 180px;">
                    <option value="" data-i18n="cfss.selectJambageType">Select Jambage Type</option>
                    <option value="JA1">JA1</option>
                    <option value="JA2a">JA2a</option>
                    <option value="JA2b">JA2b</option>
                    <option value="JA3a">JA3a</option>
                    <option value="JA4a">JA4a</option>
                    <option value="NA">N/A</option>
                </select>
                <div id="jambageImagePreview" class="type-image-preview empty" data-i18n="cfss.selectAType">
                    Select a type
                </div>
            </div>
        </div>
        <div class="form-group" style="width: 250px;">
            <label for="jambageComposition" data-i18n="cfss.jambageComposition">Jambage Composition</label>
            <div id="jambageCompositionBuilder"></div>
            <input type="hidden" id="jambageComposition" name="jambageComposition">
        </div>
    </div>
</div>

<!-- Replace the Linteau Type section with this -->
<div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
    <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 10px;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="linteauType" data-i18n="cfss.linteauType">Linteau Type</label>
            <div class="type-selection-row">
                <select id="linteauType" name="linteauType" required onchange="updateTypeImage('linteau', this.value)" style="width: 180px;">
                    <option value="" data-i18n="cfss.selectLinteauType">Select Linteau Type</option>
                    <option value="LT1">LT1</option>
                    <option value="LT2">LT2</option>
                    <option value="LT3">LT3</option>
                    <option value="LT4">LT4</option>
                    <option value="LT5">LT5</option>
                    <option value="LT6">LT6</option>
                    <option value="LT7">LT7</option>
                    <option value="LT8">LT8</option>
                    <option value="NA">N/A</option>
                </select>
                </select>
                <div id="linteauImagePreview" class="type-image-preview empty" data-i18n="cfss.selectAType">
                    Select a type
                </div>
            </div>
        </div>
        <div class="form-group" style="width: 250px;">
            <label for="linteauComposition" data-i18n="cfss.linteauComposition">Linteau Composition</label>
            <div id="linteauCompositionBuilder"></div>
            <input type="hidden" id="linteauComposition" name="linteauComposition">
        </div>
    </div>
</div>

<!-- Replace the Seuil Type section with this -->
<div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
    <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 10px;">
        <div class="form-group" style="margin-bottom: 0;">
            <label for="seuilType" data-i18n="cfss.seuilType">Seuil Type</label>
            <div class="type-selection-row">
                <select id="seuilType" name="seuilType" required onchange="updateTypeImage('seuil', this.value)" style="width: 180px;">
                    <option value="" data-i18n="cfss.selectSeuilType">Select Seuil Type</option>
                    <option value="SE1">SE1</option>
                    <option value="SE2">SE2</option>
                    <option value="SE3">SE3</option>
                    <option value="NA">N/A</option>
                </select>
                <div id="seuilImagePreview" class="type-image-preview empty" data-i18n="cfss.selectAType">
                    Select a type
                </div>
            </div>
        </div>
        <div class="form-group" style="width: 250px;">
            <label for="seuilComposition" data-i18n="cfss.seuilComposition">Seuil Composition</label>
            <div id="seuilCompositionBuilder"></div>
            <input type="hidden" id="seuilComposition" name="seuilComposition">
        </div>
    </div>
</div>
        
        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="button success">
                <i class="fas fa-save"></i> <span data-i18n="cfss.saveWindow">Save Window</span>
            </button>
        </div>
    </form>
</div>

<!-- Parapet Form -->
<div id="parapetForm" class="equipment-form-container" style="display: none;">
    <div class="calculation-sections">
        <div class="equipment-form-section">
            <div class="form-fields">
                <h2 data-i18n="cfss.newParapet">New Parapet</h2>
                <form id="parapetFormElement">

                    <!-- Parapet Name (Custom Text Input) -->
                    <div class="form-group">
                        <label for="parapetName" data-i18n="cfss.parapetName">Parapet Name:</label>
                        <input type="text" id="parapetName" name="parapetName" placeholder="Enter parapet name..." data-i18n-placeholder="cfss.enterParapetName" required>
                    </div>

                    <!-- Parapet Type (Dropdown) -->
                    <div class="form-group">
                        <label for="parapetType" data-i18n="cfss.parapetType">Parapet Type:</label>
                        <div style="display: flex; gap: 10px; align-items: flex-start;">
                            <select id="parapetType" name="parapetType" required style="flex: 1; max-width: 190px;">
                                <option value="" data-i18n="cfss.selectParapetType">Select Parapet Type</option>
                                <option value="Type 1">Type 1</option>
                                <option value="Type 2">Type 2</option>
                                <option value="Type 3">Type 3</option>
                                <option value="Type 4">Type 4</option>
                                <option value="Type 5">Type 5</option>
                                <option value="Type 6">Type 6</option>
                                <option value="Type 7">Type 7</option>
                                <option value="Type 8">Type 8</option>
                                <option value="Type 9">Type 9</option>
                                <option value="Type 10">Type 10</option>
                                <option value="Type 11">Type 11</option>
                                <option value="Type 12">Type 12</option>
                                <option value="Type 13">Type 13</option>
                            </select>
                            
                            <div id="parapetTypeImagePreview" style="
                                width: 105px;
                                height: 105px;
                                border: 1px solid #ddd;
                                border-radius: 4px;
                                background: #f9f9f9;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                            ">
                                <span style="color: #999; font-size: 13px; text-align: center;" data-i18n="cfss.selectAType">Select a type</span>
                            </div>
                        </div>
                </div>

                    <!-- Floor -->
                    <div class="form-group">
                        <label for="parapetFloor" data-i18n="cfss.floor">Floor:</label>
                        <input type="text" id="parapetFloor" name="parapetFloor" placeholder="e.g., NV2 - NV3">
                    </div>

                    <!-- Hauteur Max - Dual Input with Unit Toggle -->
                    <div class="form-group">
                        <label for="parapetHauteurMax">Hauteur Max</label>
                        <div class="hauteur-row" style="display: flex; gap: 10px; align-items: center;">
                            <input
                                type="number"
                                id="parapetHauteurMax"
                                name="parapetHauteurMax"
                                min="0"
                                step="1"
                                required
                            >
                            <input
                                type="text"
                                id="parapetHauteurMaxMinor"
                                name="parapetHauteurMaxMinor"
                                placeholder=""
                            >
                            <select
                                id="parapetHauteurMaxUnit"
                                name="parapetHauteurMaxUnit"
                                required
                                onchange="toggleMinorField('parapetHauteur')"
                            >
                                <option value="ft-in" selected>ft-in</option>
                                <option value="mm">mm</option>
                            </select>
                        </div>
                    </div>

                    <!-- Set 1 and Set 2 Container -->
    <div id="parapetSetsWrapper" style="display: flex; gap: 20px;">
        
        <!-- SET 1 -->
        <div id="parapetSet1" style="flex: 1; min-width: 0;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 1</h4> 
                <button type="button" id="addParapetSet2Btn" onclick="toggleParapetSet2(true)" 
                        style="background: #28a745; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    +
                </button>
            </div>

                    <!-- Montant Métallique -->
                    <div class="form-group">
                        <label for="parapetMontantMetallique">Montant Métallique:</label>
                        <select id="parapetMontantMetallique" name="parapetMontantMetallique" required>
                            <option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Espacement -->
                    <div class="form-group">
                        <label for="parapetEspacement">Espacement:</label>
                        <select id="parapetEspacement" name="parapetEspacement" required>
                            <option value="">Select espacement...</option>
                            <option value="8&quot;c/c">8"c/c</option>
                            <option value="12&quot;c/c">12"c/c</option>
                            <option value="16&quot;c/c">16"c/c</option>
                            <option value="24&quot;c/c">24"c/c</option>
                        </select>
                    </div>

                    <!-- Lisse Supérieure -->
                    <div class="form-group">
                        <label for="parapetLisseSuperieure">Lisse Supérieure:</label>
                        <input type="text" id="parapetLisseSuperieure" placeholder="Will be auto-filled..." required>
                    </div>

                    <!-- Lisse Inférieure -->
                    <div class="form-group">
                        <label for="parapetLisseInferieure">Lisse Inférieure:</label>
                        <input type="text" id="parapetLisseInferieure" placeholder="Will be auto-filled..." required>
                    </div>

                    <!-- Entremise -->
                    <div class="form-group">
                        <label for="parapetEntremise">Entremise:</label>
                        <select id="parapetEntremise" name="parapetEntremise" required>
                            <option value="N/A" selected>N/A</option>
                            <option value="150U75-43">150U75-43</option>
                        </select>
                    </div>
        </div>

        <!-- SET 2 (Initially Hidden) -->
        <div id="parapetSet2" style="flex: 1; min-width: 0; display: none;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 2</h4>
                <button type="button" id="removeParapetSet2Btn" onclick="toggleParapetSet2(false)" 
                        style="background: #dc3545; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    ×
                </button>
            </div>

                    <!-- Montant Métallique 2 -->
                    <div class="form-group">
                        <label for="parapetMontantMetallique2">Montant Métallique 2:</label>
                        <select id="parapetMontantMetallique2" name="parapetMontantMetallique2">
                            <option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Espacement 2 -->
                    <div class="form-group">
                        <label for="parapetEspacement2">Espacement 2:</label>
                        <select id="parapetEspacement2" name="parapetEspacement2">
                            <option value="">Select espacement...</option>
                            <option value="8&quot;c/c">8"c/c</option>
                            <option value="12&quot;c/c">12"c/c</option>
                            <option value="16&quot;c/c" selected>16"c/c</option>
                            <option value="24&quot;c/c">24"c/c</option>
                        </select>
                    </div>

                    <!-- Lisse Supérieure 2 -->
                    <div class="form-group">
                        <label for="parapetLisseSuperieure2">Lisse Supérieure 2:</label>
                        <input type="text" id="parapetLisseSuperieure2" placeholder="Will be auto-filled...">
                    </div>

                    <!-- Lisse Inférieure 2 -->
                    <div class="form-group">
                        <label for="parapetLisseInferieure2">Lisse Inférieure 2:</label>
                        <input type="text" id="parapetLisseInferieure2" placeholder="Will be auto-filled...">
                    </div>

                    <!-- Entremise 2 -->
                    <div class="form-group">
                        <label for="parapetEntremise2">Entremise 2:</label>
                        <select id="parapetEntremise2" name="parapetEntremise2">
                            <option value="N/A" selected>N/A</option>
                            <option value="150U75-43">150U75-43</option>
                        </select>
                    </div>
        </div>
    </div>

                    <!-- Image Upload Section for Parapet -->
                    <label style="display: block; font-weight: 500; margin-bottom: 5px; color: #333;" data-i18n="cfss.images">Images:</label>
                    <div class="image-upload-section" style="position: static; flex: none; width: 100%;">
                        <div class="upload-controls">
                            <button type="button" class="camera-btn" id="parapetCameraBtn" title="Upload Image" data-i18n-title="cfss.uploadImage">
                                <i class="fas fa-camera"></i>
                                <span data-i18n="common.browse">Browse</span>
                            </button>

                            <input
                                class="drop-zone"
                                id="parapetDropZone"
                                placeholder="Drop or paste image here (Ctrl+V)" data-i18n-placeholder="cfss.dropOrPasteImage"
                                readonly
                                tabindex="0">
                        </div>

                        <div class="image-preview-container" id="parapetImagePreviewContainer"></div>
                        <input type="file" id="parapetImageFileInput" accept="image/*" style="display: none;">
                    </div>

                    <!-- Save Button -->
                    <div style="margin-top: 20px;">
                        <button type="submit" id="saveParapet" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; width: 100%;">
                            <i class="fas fa-save"></i> <span data-i18n="cfss.saveParapet">Save Parapet</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

        </div>
        </div><!-- end cfssBottomHalf -->

        <!-- Seismic Ceiling section (only shown for projects with rooms data) -->
        <div id="seismicCeilingSection" style="display: none;">
            <div class="top-half" style="height: auto;">
                <div class="left-section">
                    <h1>Seismic Ceiling Details</h1>

                    <div class="basic-info">
                        <p><strong>Project Name:</strong> <span id="seismicProjectName"></span></p>
                        <p><strong>Company Name:</strong> <span id="seismicCompanyName"></span></p>
                        <p><strong>Client Name:</strong> <span id="seismicClientName"></span></p>
                        <p><strong>Address:</strong> <span id="seismicAddress"></span></p>
                        <p><strong>Status:</strong> <span id="seismicStatus"></span></p>
                    </div>

                    <div id="seismicAdminInfo" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;"></div>
                </div>

                <div class="right-section">
                    <div class="selection-summary" id="roomSelectionSummary">
                        <i class="fas fa-door-open"></i> 0 rooms added
                    </div>
                    <div class="tab-content" style="flex: 1; overflow-y: auto;">
                        <div id="roomList" class="equipment-list">
                            <!-- Rooms will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom: Add Room button + Room form -->
            <div class="bottom-half" id="adminRoomBottomHalf">
                <button id="adminAddRoomButton" class="cfss-btn" style="display: block !important; margin: 20px 0;">
                    <i class="fas fa-plus-circle"></i> Add Room
                </button>

                <div id="adminRoomForm" style="display: none;">
                    <div class="calculation-sections">
                        <div class="equipment-form-section">
                            <div class="form-fields">
                                <h2 id="adminRoomFormTitle">New Room</h2>
                                <form id="adminRoomFormElement">
                                    <div class="form-group">
                                        <label for="adminRoomNumber">Room Number: <span style="color: red;">*</span></label>
                                        <input type="text" id="adminRoomNumber" name="roomNumber" placeholder="Enter room number..." required>
                                    </div>

                                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                                        <button type="submit" id="adminSaveRoom" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                            <i class="fas fa-save"></i> Save Room
                                        </button>
                                        <button type="button" id="adminCancelRoom" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <div class="image-upload-section">
                                <div class="upload-controls">
                                    <button type="button" class="camera-btn" id="adminRoomCameraBtn" title="Upload Images">
                                        <i class="fas fa-camera"></i>
                                        <span>Browse</span>
                                    </button>
                                    <input class="drop-zone" id="adminRoomDropZone" placeholder="Drop or paste images here (Ctrl+V) — max 10 images" readonly tabindex="0">
                                </div>
                                <div class="image-preview-container" id="adminRoomImagePreviewContainer"></div>
                            </div>
                            <input type="file" id="adminRoomImageFileInput" multiple accept="image/*" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- AWS Cognito SDK -->
    <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1692.0/dist/aws-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.15/dist/amazon-cognito-identity.min.js"></script>
    <script src="translations.js"></script>
    <script src="i18n.js"></script>
    <script src="auth-helper.js"></script>

    <script>
    // Colombian data mapping from CSV
    const colombageData = {
        "162S125-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S162-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S125-43": { lisseSuperieur: "162ST250-43 TROUÉE", lisseInferieure: "162T125-43" },
        "250S125-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S162-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S200-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S125-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S162-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S200-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S125-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S200-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S200-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S162-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "250S200-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "362S125-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S162-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S200-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S125-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S162-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S200-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S125-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S200-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S200-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S162-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "362S200-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "212CH-18": { lisseSuperieur: "212CHT250-18 TROUÉE", lisseInferieure: "212CHT125-18" },
        "212CH-34": { lisseSuperieur: "212CHT250-34 TROUÉE", lisseInferieure: "212CHT125-34" },
        "250CH-18": { lisseSuperieur: "250CHT250-18 TROUÉE", lisseInferieure: "250CHT125-18" },
        "250CH-34": { lisseSuperieur: "250CHT250-34 TROUÉE", lisseInferieure: "250CHT125-34" },
        "300CH-18": { lisseSuperieur: "300CHT250-18 TROUÉE", lisseInferieure: "300CHT125-18" },
        "300CH-34": { lisseSuperieur: "300CHT250-34 TROUÉE", lisseInferieure: "300CHT125-34" },
        "350CH-18": { lisseSuperieur: "350CHT250-18 TROUÉE", lisseInferieure: "350CHT125-18" },
        "350CH-34": { lisseSuperieur: "350CHT250-34 TROUÉE", lisseInferieure: "350CHT125-34" },
        "400CH-18": { lisseSuperieur: "400CHT250-18 TROUÉE", lisseInferieure: "400CHT125-18" },
        "400CH-34": { lisseSuperieur: "400CHT250-34 TROUÉE", lisseInferieure: "400CHT125-34" },
        "600S125-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S162-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S200-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S125-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S162-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S200-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S125-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S200-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S200-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S162-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "600S200-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "800S125-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S162-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S200-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S125-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S162-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S200-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S125-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S200-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S200-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S162-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "800S200-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "1000S125-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S162-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S200-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S125-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S162-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S200-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" }
    };

    // Initialize form functionality
    document.addEventListener('DOMContentLoaded', function() {
        initializeMontantDropdown();
        setupMontantChangeHandler();
        setupParapetMontantAutoFill();
        initializeTabSystem();
        initializeOptionsSystem();
    });

    function toggleSet2(show) {
    const set2 = document.getElementById('set2');
    const addBtn = document.getElementById('addSet2Btn');
    
    if (show) {
        set2.style.display = 'block';
        addBtn.style.display = 'none';
    } else {
        set2.style.display = 'none';
        addBtn.style.display = 'inline-block';
        
        // Clear Set 2 fields
        const montant2 = document.getElementById('montantMetallique2');
        const espacement2 = document.getElementById('espacement2');
        const lisseSuperieure2 = document.getElementById('lisseSuperieure2');
        const lisseInferieure2 = document.getElementById('lisseInferieure2');
        const entremise2 = document.getElementById('entremise2');
        
        if (montant2) montant2.value = '';
        if (espacement2) espacement2.value = '';
        if (lisseSuperieure2) lisseSuperieure2.value = '';
        if (lisseInferieure2) lisseInferieure2.value = '';
        if (entremise2) entremise2.value = '';
    }
}

    function toggleParapetSet2(show) {
    const set2 = document.getElementById('parapetSet2');
    const addBtn = document.getElementById('addParapetSet2Btn');
    
    if (show) {
        set2.style.display = 'block';
        addBtn.style.display = 'none';
    } else {
        set2.style.display = 'none';
        addBtn.style.display = 'inline-block';
        
        // Clear Set 2 fields
        document.getElementById('parapetMontantMetallique2').value = '';
        document.getElementById('parapetEspacement2').value = '';
        document.getElementById('parapetLisseSuperieure2').value = '';
        document.getElementById('parapetLisseInferieure2').value = '';
        document.getElementById('parapetEntremise2').value = '';
    }
}

// Populate the Montant Métallique dropdown
function initializeMontantDropdown() {
    const montantSelect = document.getElementById('montantMetallique');
    const montantSelect2 = document.getElementById('montantMetallique2');
    const parapetMontantSelect = document.getElementById('parapetMontantMetallique');
    
    if (!montantSelect) return;

    // Clear and populate Set 1
    montantSelect.innerHTML = '<option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>';
    
    const sortedKeys = Object.keys(colombageData).sort();
    sortedKeys.forEach(montant => {
        const option = document.createElement('option');
        option.value = montant;
        option.textContent = montant;
        montantSelect.appendChild(option);
    });

    // Populate Set 2
    if (montantSelect2) {
        montantSelect2.innerHTML = '<option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>';
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            montantSelect2.appendChild(option);
        });
    }

    // Populate Parapet Montant Dropdown
    if (parapetMontantSelect) {
        parapetMontantSelect.innerHTML = '<option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>';
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            parapetMontantSelect.appendChild(option);
        });
        console.log(`Populated parapet montant dropdown with ${sortedKeys.length} options`);
    }
    
    // Populate Parapet Montant Set 2 Dropdown
    const parapetMontantSelect2 = document.getElementById('parapetMontantMetallique2');
    if (parapetMontantSelect2) {
        parapetMontantSelect2.innerHTML = '<option value="" data-i18n="cfss.selectMontant">Select Montant Métallique...</option>';
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            parapetMontantSelect2.appendChild(option);
        });
    }

    console.log(`Populated ${sortedKeys.length} Montant Métallique options for walls and parapets`);
}

    // Setup change handler for montant selection
function setupMontantChangeHandler() {
    const montantSelect = document.getElementById('montantMetallique');
    const lisseSuperieureInput = document.getElementById('lisseSuperieure');
    const lisseInferieureInput = document.getElementById('lisseInferieure');
    
    const montantSelect2 = document.getElementById('montantMetallique2');
    const lisseSuperieureInput2 = document.getElementById('lisseSuperieure2');
    const lisseInferieureInput2 = document.getElementById('lisseInferieure2');

    // Set 1 handler
    if (montantSelect && lisseSuperieureInput && lisseInferieureInput) {
        montantSelect.addEventListener('change', function() {
            const selectedMontant = this.value;
            
            if (selectedMontant && colombageData[selectedMontant]) {
                const data = colombageData[selectedMontant];
                lisseSuperieureInput.value = data.lisseSuperieur;
                lisseInferieureInput.value = data.lisseInferieure;
                
                lisseSuperieureInput.classList.add('auto-filled');
                lisseInferieureInput.classList.add('auto-filled');
                
                [lisseSuperieureInput, lisseInferieureInput].forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('auto-filled');
                    }, { once: true });
                });
            } else {
                lisseSuperieureInput.value = '';
                lisseInferieureInput.value = '';
                lisseSuperieureInput.classList.remove('auto-filled');
                lisseInferieureInput.classList.remove('auto-filled');
            }
        });
    }

    // Set 2 handler
    if (montantSelect2 && lisseSuperieureInput2 && lisseInferieureInput2) {
        montantSelect2.addEventListener('change', function() {
            const selectedMontant = this.value;
            
            if (selectedMontant && colombageData[selectedMontant]) {
                const data = colombageData[selectedMontant];
                lisseSuperieureInput2.value = data.lisseSuperieur;
                lisseInferieureInput2.value = data.lisseInferieure;
                
                lisseSuperieureInput2.classList.add('auto-filled');
                lisseInferieureInput2.classList.add('auto-filled');
                
                [lisseSuperieureInput2, lisseInferieureInput2].forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('auto-filled');
                    }, { once: true });
                });
            } else {
                lisseSuperieureInput2.value = '';
                lisseInferieureInput2.value = '';
                lisseSuperieureInput2.classList.remove('auto-filled');
                lisseInferieureInput2.classList.remove('auto-filled');
            }
        });
    }
}

    // Update the form validation function to work with dropdowns
    function getWallFormDataWithImages() {
        console.log('=== DEBUG: Starting form validation with dropdowns ===');
        
        // Get elements first and check if they exist
        const equipmentEl = document.getElementById('equipment');
        const floorEl = document.getElementById('floor');
        const hauteurMaxEl = document.getElementById('hauteurMax');
        const deflexionMaxEl = document.getElementById('deflexionMax');
        const montantMetalliqueEl = document.getElementById('montantMetallique');
        const lisseSuperieureEl = document.getElementById('lisseSuperieure');
        const lisseInferieureEl = document.getElementById('lisseInferieure');
        const entremiseEl = document.getElementById('entremise');

        // Get values
        const equipment = equipmentEl ? equipmentEl.value.trim() : '';
        const floor = floorEl ? floorEl.value.trim() : '';
        const hauteurMax = hauteurMaxEl ? hauteurMaxEl.value.trim() : '';
        const deflexionMax = deflexionMaxEl ? deflexionMaxEl.value.trim() : '';
        const montantMetallique = montantMetalliqueEl ? montantMetalliqueEl.value.trim() : '';
        const lisseSuperieure = lisseSuperieureEl ? lisseSuperieureEl.value.trim() : '';
        const lisseInferieure = lisseInferieureEl ? lisseInferieureEl.value.trim() : '';
        const entremise = entremiseEl ? entremiseEl.value.trim() : '';

        // Debug: Check values
        console.log('Form values:', {
            equipment, floor, hauteurMax, deflexionMax, 
            montantMetallique, lisseSuperieure, lisseInferieure, entremise
        });

        // Validation
        if (!equipment) {
            alert('Please enter a wall name.');
            return null;
        }

        if (!floor) {
            alert('Please enter a floor.');
            return null;
        }

        if (!hauteurMax) {
            alert('Please select a hauteur max.');
            return null;
        }

        if (!deflexionMax) {
            alert('Please select a déflexion max.');
            return null;
        }

        if (!montantMetallique) {
            alert('Please select Montant Métallique.');
            return null;
        }

        if (!lisseSuperieure) {
            alert('Please enter lisse Supérieure.');
            return null;
        }

        if (!lisseInferieure) {
            alert('Please enter lisse Inférieure.');
            return null;
        }

        if (!entremise) {
            alert('Please select entremise.');
            return null;
        }

        console.log('=== DEBUG: All validations passed ===');

        const wallData = {
            equipment: equipment,
            floor: floor,
            hauteurMax: hauteurMax, // Now a string from dropdown
            deflexionMax: deflexionMax,
            montantMetallique: montantMetallique,
            lisseSuperieure: lisseSuperieure,
            lisseInferieure: lisseInferieure,
            entremise: entremise,
            images: [...(window.currentWallImages || [])], // Include uploaded images
            dateAdded: new Date().toISOString(),
            addedBy: window.currentUser?.email || 'unknown'
        };

        console.log('Final wall data:', wallData);
        return wallData;
    }

    // Make the function globally available
    window.getWallFormDataWithImages = getWallFormDataWithImages;
    window.colombageData = colombageData;
    </script>
    
    <script src="config.js"></script>
    <script>
    function initGoogleMaps() {
        console.log('Google Maps API loaded successfully for CFSS project details');
    }
    
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=${CONFIG.GOOGLE_API_KEY}&libraries=places&loading=async&callback=initGoogleMaps`;
    script.async = true;
    script.defer = true;
    script.onerror = () => console.error('Failed to load Google Maps API');
    document.head.appendChild(script);
    </script>
    
    <script src="cfss-project-details.js"></script>
    <script src="cfss-project-details-init.js"></script>
    <script src="cfss-custom-pages.js"></script>
        
    <script src="cfss-wall-calc-data.js"></script>
    <script src="cfss-wall-calc-logic.js"></script>
    <script src="cfss-wall-calc-ui.js"></script>

</body>
</html>