<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFSS Project Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="project-details.css">
    <link rel="stylesheet" href="cfss-project-details.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

        <!-- SortableJS for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script> 

</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="title-area">
                <a href="https://www.protectionsismique2000.com/" class="title">Protection Sismique - CFSS</a>
                <a href="cfss-dashboard.html" class="dashboard-btn">
                    <i class="fas fa-th-large"></i>
                    Dashboard
                </a>
            </div>
            <div class="user-info" id="userInfo">
                <!-- User info will be populated by JavaScript -->
            </div>
        </div>
    </nav>
    
    <div class="loading-project" id="loadingProject">
        <h2>Loading CFSS Project...</h2>
        <p>Please wait while we load the project details.</p>
    </div>
    
    <div class="auth-error" id="authError" style="display: none;">
        <h2>Authentication Required</h2>
        <p>Please log in to view CFSS project details.</p>
        <button onclick="window.location.href='auth.html'">Go to Login</button>
    </div>
    
    <div class="access-denied" id="accessDenied" style="display: none;">
        <h2>Access Denied</h2>
        <p>You don't have permission to view this CFSS project.</p>
        <button onclick="window.location.href='cfss-dashboard.html'">Back to CFSS Dashboard</button>
    </div>
    
    <div class="container" id="projectContainer" style="display: none;">
        <!-- Top Half split into two horizontal sections -->
        <div class="top-half">
            <div class="left-section">
                <h1>CFSS Project Details</h1>
                
                <!-- Basic Information (Always Visible) -->
                <div class="basic-info">
                    <p><strong>Project Name:</strong> <span id="projectName"></span></p>
                    <p><strong>Project Number:</strong> <span id="projectNumber"></span></p>
                    <p><strong>Client Email(s):</strong> <span id="clientEmails"></span></p>
                    <p><strong>Description:</strong> <span id="projectDescription"></span></p>
                    <p><strong>Type:</strong> <span id="projectType"></span></p>
                    <p><strong>Status:</strong> 
                        <select id="projectStatusDropdown">
                            <option value="Planning">Planning</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </p>
                    <p><strong>Address:</strong> <span id="projectAddress"></span></p>
                </div>

                <!-- CFSS Data Display (shows saved data) -->
                <div id="cfssDataDisplay" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                    <h3 style="margin: 0 0 10px 0; color: #17a2b8; font-size: 16px;">CFSS Wind Data</h3>
                    <div id="cfssDataContent">
                        <!-- CFSS data will be populated here by JavaScript -->
                    </div>
                </div>

                <div id="projectOwnerInfo">
                    <!-- Owner info will be populated for admins -->
                </div>
            </div>
            <div class="right-section">
                <!-- NEW: Tab Interface -->
                <div class="tab-header">
                    <button class="tab-button active" data-tab="wall-list">
                        <i class="fas fa-wall-brick"></i>
                        Wall List
                    </button>
                    <button class="tab-button" data-tab="parapet-list">
                        <i class="fas fa-wall-brick"></i>
                        Parapet List
                    </button>
                    <button class="tab-button" data-tab="option-list">
                        <i class="fas fa-cogs"></i>
                        Option List
                    </button>
                    <button class="tab-button" data-tab="window-list">
                        <i class="fas fa-window-maximize"></i>
                        Window List
                    </button>
                    <button class="tab-button" data-tab="custom-pages">
                        <i class="fas fa-file-alt"></i>
                        Custom Pages
                    </button>
                </div>

                <div class="tab-content">
                    <!-- Wall List Tab Content -->
                    <div id="wall-list-content" class="tab-content-section active">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;">Wall List</h1>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-file-pdf"></i> Generate CFSS Report
                                </button>
                                <button id="sendReportToClientsButton" class="button primary" style="background:#0069d9;">
                                    <i class="fas fa-paper-plane"></i> Send Report to Client(s)
                                </button>
                            </div>
                        </div>
                        <div id="equipmentList"></div>
                    </div>

                    <!-- Parapet List Tab Content -->
                    <div id="parapet-list-content" class="tab-content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h1 style="margin: 0;">Parapet List</h1>
                            <div class="selection-summary" id="parapetSelectionSummary">
                                <i class="fas fa-building"></i> 0 parapets added
                            </div>
                        </div>
                        <div id="parapetList" class="equipment-list">
                            <!-- Parapets will be displayed here -->
                        </div>
                    </div>

                    <!-- Options List Tab Content -->
                    <div id="option-list-content" class="tab-content-section">
                        <div class="selection-summary" id="selectionSummary">
                            <i class="fas fa-check-circle"></i> 0 options selected
                        </div>

                        <!-- Category 1: Lisse Trouée -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-grip-horizontal"></i>
                                Lisse Trouée
                            </div>
                            <div id="lisse-trouee-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 2: Double Lisse -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-equals"></i>
                                Double Lisse
                            </div>
                            <div id="double-lisse-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 3: Lisse Basse -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-minus"></i>
                                Lisse Basse
                            </div>
                            <div id="lisse-basse-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 4: Parapet -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-building"></i>
                                Parapet
                            </div>
                            <div id="parapet-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Category 5: Detail Structure -->
                        <div class="options-category">
                            <div class="category-header">
                                <i class="fas fa-drafting-compass"></i>
                                Detail Structure
                            </div>
                            <div id="detail-structure-options">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="save-options-btn">
                            <button class="save-btn" id="saveOptionsBtn">
                                <i class="fas fa-save"></i>
                                Save Options
                            </button>
                        </div>
                    </div>

                    <div id="window-list-content" class="tab-content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h1 style="margin: 0;">Window List</h1>
                        <div class="selection-summary" id="windowSelectionSummary">
                            <i class="fas fa-window-maximize"></i> 0 windows added
                        </div>
                    </div>
                    <div id="windowList" class="equipment-list">
                        <!-- Windows will be displayed here -->
                    </div>
                </div>

                <!-- Custom Pages Tab Content -->
                <div id="custom-pages-content" class="tab-content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h1 style="margin: 0;">Custom Pages</h1>
                        <button id="addCustomPageButton" class="button primary" style="background: #007bff;">
                            <i class="fas fa-plus"></i> Add Custom Page
                        </button>
                    </div>
                    
                    <!-- Custom Pages List -->
                    <div id="customPagesList" style="margin-bottom: 30px;">
                        <!-- Pages will be listed here -->
                    </div>
                    
                    <!-- Custom Page Builder (Hidden by default) -->
                    <div id="customPageBuilder" style="display: none;">
                        <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <input type="text" id="customPageTitle" placeholder="Page Title" 
                                    style="flex: 1; padding: 10px; font-size: 16px; border: 1px solid #dee2e6; border-radius: 4px; margin-right: 15px;">
                                <button onclick="saveCustomPage()" class="button primary" style="background: #28a745;">
                                    <i class="fas fa-save"></i> Save Page
                                </button>
                                <button onclick="cancelCustomPageEdit()" class="button secondary" style="margin-left: 10px;">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                            
<div style="display: flex; gap: 20px; margin-bottom: 20px;">
    <!-- Left: Element Palette -->
    <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
        <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;">Add Elements</h3>
        <div id="elementPalette" style="display: flex; gap: 10px;">
            <div class="palette-item" draggable="true" data-type="heading" style="flex: 1;">
                <i class="fas fa-heading"></i>
                <span>Heading</span>
            </div>
            <div class="palette-item" draggable="true" data-type="text" style="flex: 1;">
                <i class="fas fa-paragraph"></i>
                <span>Text Block</span>
            </div>
            <div class="palette-item" draggable="true" data-type="image" style="flex: 1;">
                <i class="fas fa-image"></i>
                <span>Image</span>
            </div>
        </div>
    </div>
    
    <!-- Right: Properties -->
    <div style="flex: 1; background: #f8f9fa; border-radius: 8px; padding: 15px;">
        <h3 style="font-size: 14px; margin-bottom: 15px; color: #333;">Properties</h3>
        <div id="customPageProperties" class="properties-card">
            <p style="color: #6c757d; font-size: 13px; text-align: center; padding: 20px 10px;">
                Select an element to edit its properties
            </p>
        </div>
    </div>
</div>

<!-- Bottom Section: Canvas (Full Width) -->
<div style="background: #e9ecef; border-radius: 8px; overflow: auto; display: flex; justify-content: center;">
    <!-- PDF-sized canvas: 8.5" x 11" ratio (850px x 1100px) -->
    <div id="customPageCanvas" class="custom-page-canvas">
</div>
        <div class="canvas-empty-state">
        </div>
    </div>
</div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <!-- Bottom Half for Wall Details -->
        <div class="bottom-half">
            <div class="cfss-data-section">
                <button class="cfss-btn" onclick="toggleCFSSForm()">
                    <i class="fas fa-plus"></i>
                    <span id="cfss-btn-text">Add CFSS Data</span>
                </button>
                
                <div id="cfss-form" class="cfss-form hidden">
                    <!-- Floor-specific sections (can have multiple) -->
                    <div id="floor-sections">
                        <div class="floor-section">
                            <div class="main-fields-row">
                                <div class="field-group floor-range">
                                    <label>Floor Range:</label>
                                    <input type="text" class="floor-input" placeholder="e.g., 1-4">
                                </div>
                                
                                <div class="field-group resistance">
                                    <label>Resistance:</label>
                                    <div class="field-with-unit">
                                        <input type="number" class="value-input" placeholder="0.0" step="0.1">
                                        <span class="unit-label">psf</span>
                                    </div>
                                </div>
                                
                                <div class="field-group deflection">
                                    <label>Deflection:</label>
                                    <div class="field-with-unit">
                                        <input type="number" class="value-input" placeholder="0.0" step="0.1">
                                        <span class="unit-label">psf</span>
                                    </div>
                                </div>
                                
                                <button class="remove-btn" onclick="removeCFSSSection(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add Floor Section Button -->
                    <button class="add-section-btn" onclick="addCFSSFloorSection()">
                        <i class="fas fa-plus"></i> Add Floor Section
                    </button>
                    
                    <!-- Project-wide fields (single instance) -->
                    <div class="project-fields">
                        <div class="field-row">
                            <label>La déflexion maximale permise pour les éléments d'ossature extérieure:</label>
                            <input type="text" id="maxDeflection" class="text-input" placeholder="Enter max deflection">
                        </div>
                        
                        <div class="field-row">
                            <label>La distance maximale  entre les entretoises:</label>
                            <input type="text" id="maxSpacing" class="text-input" placeholder="Enter max spacing">
                        </div>
                        
                        <div class="field-row">
                            <label>Assemblage des éléments d'ossature entre eux:</label>
                            <input type="text" id="framingAssembly" class="text-input" placeholder="Enter framing assembly">
                        </div>
                        
                        <div class="field-row">
                            <label>Ancrage des lisses au béton:</label>
                            <input type="text" id="concreteAnchor" class="text-input" placeholder="Enter concrete anchor">
                        </div>
                        
                        <div class="field-row">
                            <label>Ancrage des lisses à l'acier:</label>
                            <input type="text" id="steelAnchor" class="text-input" placeholder="Enter steel anchor">
                        </div>
                
                    <!-- Save Button -->
                    <button class="save-cfss-btn" onclick="saveCFSSData()">
                        <i class="fas fa-save"></i> Save CFSS Data
                    </button>
                </div>
            </div>
            
            <!-- Moved OUTSIDE of cfss-data-section -->
            <button id="newCalculationButton" style="display: block !important; margin: 20px 0;">Add Wall</button>

            <button id="addParapetButton" class="button secondary" style="display: block !important; margin: 20px 0;">
                <i class="fas fa-building"></i> Add Parapet
            </button>

            <button id="addWindowButton" class="button secondary">
                <i class="fas fa-window-maximize"></i> Add Window
            </button>

            <div id="equipmentForm">
                <div class="calculation-sections">
                    <!-- Section 1: Wall Form -->
                    <div class="equipment-form-section">
                        <!-- Form Fields (Left side within the section) -->
                        <div class="form-fields">
                            <h2>New Wall</h2>
                            <form id="equipmentFormElement">
                                <!-- 1. Wall Name -->
                                <div class="form-group">
                                    <label for="equipment">Wall Name:</label>
                                    <input type="text" id="equipment" name="equipment" placeholder="Enter wall name..." required>
                                </div>

                                <!-- 2. Floor -->
                                <div class="form-group">
                                    <label for="floor">Floor:</label>
                                    <input type="text" id="floor" name="floor" placeholder="Enter floor..." required>
                                </div>

                                <!-- 3. Hauteur Max - MANUAL INPUT WITH UNIT SELECTION -->
                                <div class="form-group">
                                    <label for="hauteurMax">Hauteur Max:</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input 
                                            type="number" 
                                            id="hauteurMax" 
                                            name="hauteurMax" 
                                            min="0"
                                            step="1"
                                            required 
                                            style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                        <select 
                                            id="hauteurMaxUnit" 
                                            name="hauteurMaxUnit" 
                                            required 
                                            style="flex: 1; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                            <option value="ft" selected>ft</option>
                                            <option value="m">m</option>
                                        </select>
                                        <input 
                                            type="number" 
                                            id="hauteurMaxMinor" 
                                            name="hauteurMaxMinor" 
                                            min="0"
                                            step="1"
                                            style="flex: 2; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                        <select 
                                            id="hauteurMaxMinorUnit" 
                                            name="hauteurMaxMinorUnit" 
                                            style="flex: 1; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                            <option value="in" selected>in</option>
                                            <option value="mm">mm</option>
                                        </select>
                                    </div>
                                    <div id="hauteurPreview" style="margin-top: 5px; font-size: 12px; color: #666; font-style: italic;">
                                        Preview: --
                                    </div>
                                </div>

                                <!-- 4. Déflexion Max -->
                                <div class="form-group">
                                    <label for="deflexionMax">Déflexion Max:</label>
                                    <select id="deflexionMax" name="deflexionMax" required>
                                        <option value="">Select déflexion max...</option>
                                        <option value="L/360">L/360</option>
                                        <option value="L/480">L/480</option>
                                        <option value="L/600">L/600</option>
                                        <option value="L/720">L/720</option>
                                    </select>
                                </div>

<!-- Dual Set Container -->
<div id="dualSetContainer" style="position: relative;">
    <!-- Set 1 and Set 2 Container -->
    <div id="setsWrapper" style="display: flex; gap: 20px;">
        
        <!-- SET 1 -->
        <div id="set1" style="flex: 1; min-width: 0;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 1</h4>
                <button type="button" id="addSet2Btn" onclick="toggleSet2(true)" 
                        style="background: #28a745; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    +
                </button>
            </div>

            <!-- 5. Montant Métallique - NOW A DROPDOWN -->
            <div class="form-group">
                <label for="montantMetallique">Montant Métallique:</label>
                <select id="montantMetallique" name="montantMetallique" required>
                    <option value="">Select montant métallique...</option>
                    <!-- Options will be populated by JavaScript from CSV data -->
                </select>
            </div>

            <!-- 9. Espacement - DROPDOWN -->
            <div class="form-group">
                <label for="espacement">Espacement:</label>
                <select id="espacement" name="espacement" required>
                    <option value="">Select espacement...</option>
                    <option value="8&quot;c/c">8"c/c</option>
                    <option value="12&quot;c/c">12"c/c</option>
                    <option value="16&quot;c/c">16"c/c</option>
                    <option value="24&quot;c/c">24"c/c</option>
                </select>
            </div>

            <!-- 6. Lisse Supérieure - AUTO-POPULATED BUT EDITABLE -->
            <div class="form-group">
                <label for="lisseSuperieure">Lisse Supérieure:</label>
                <input type="text" id="lisseSuperieure" name="lisseSuperieure" placeholder="Will be auto-filled based on montant selection..." required>
            </div>

            <!-- 7. Lisse Inférieure - AUTO-POPULATED BUT EDITABLE -->
            <div class="form-group">
                <label for="lisseInferieure">Lisse Inférieure:</label>
                <input type="text" id="lisseInferieure" name="lisseInferieure" placeholder="Will be auto-filled based on montant selection..." required>
            </div>

            <!-- 8. Entremise - NOW A DROPDOWN -->
            <div class="form-group">
                <label for="entremise">Entremise:</label>
                <select id="entremise" name="entremise" required>
                    <option value="">Select entremise...</option>
                    <option value="150U75-43">150U75-43</option>
                    <option value="N/A">N/A</option>
                </select>
            </div>
        </div>

        <!-- SET 2 (Initially Hidden) -->
        <div id="set2" style="flex: 1; min-width: 0; display: none;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h4 style="margin: 0; font-size: 14px; color: #666;">Set 2</h4>
                <button type="button" id="removeSet2Btn" onclick="toggleSet2(false)" 
                        style="background: #dc3545; color: white; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                    ×
                </button>
            </div>

            <!-- Montant Métallique 2 -->
            <div class="form-group">
                <label for="montantMetallique2">Montant Métallique 2:</label>
                <select id="montantMetallique2" name="montantMetallique2">
                    <option value="">Select montant métallique...</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>

            <!-- Espacement 2 -->
            <div class="form-group">
                <label for="espacement2">Espacement 2:</label>
                <select id="espacement2" name="espacement2">
                    <option value="">Select espacement...</option>
                    <option value="8&quot;c/c">8"c/c</option>
                    <option value="12&quot;c/c">12"c/c</option>
                    <option value="16&quot;c/c">16"c/c</option>
                    <option value="24&quot;c/c">24"c/c</option>
                </select>
            </div>

            <!-- Lisse Supérieure 2 -->
            <div class="form-group">
                <label for="lisseSuperieure2">Lisse Supérieure 2:</label>
                <input type="text" id="lisseSuperieure2" name="lisseSuperieure2" placeholder="Will be auto-filled...">
            </div>

            <!-- Lisse Inférieure 2 -->
            <div class="form-group">
                <label for="lisseInferieure2">Lisse Inférieure 2:</label>
                <input type="text" id="lisseInferieure2" name="lisseInferieure2" placeholder="Will be auto-filled...">
            </div>

            <!-- Entremise 2 -->
            <div class="form-group">
                <label for="entremise2">Entremise 2:</label>
                <select id="entremise2" name="entremise2">
                    <option value="">Select entremise...</option>
                    <option value="150U75-43">150U75-43</option>
                    <option value="N/A">N/A</option>
                </select>
            </div>
        </div>
    </div>
</div>

                                <div class="form-group">
                                    <label for="note">Note:</label>
                                    <input type="text" id="note" name="note" maxlength="100" placeholder="Optional note (max 100 characters)..." style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <div class="form-hint">Maximum 100 characters</div>
                                </div>
                                
                                <!-- Calculate and Save Buttons -->
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" id="calculateEquipment" style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-calculator"></i> Calculate
                                    </button>
                                    <button type="submit" id="saveEquipment" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                </div>
                            </form>
                        </div>

                            <!-- Image Upload Section (Right side within the section) -->
                            <!-- This will be dynamically added by JavaScript via initializeImageUpload() -->
                            
                            <input type="file" id="imageFileInput" multiple accept="image/*" style="display: none;">
                        </div>

                    <!-- Section 2: Placeholder for calculations (no calculations for CFSS) -->
                    <div class="calculation-results-section">
                        <div id="calculationResults" style="display: none;">
                            <h2>Wall Details</h2>
                            <div id="calculationResultsContent"></div>
                        </div>
                        <div id="calculationPlaceholder">
                            <h2 style="color: #666; text-align: center; margin-bottom: 10px;">Wall Details</h2>
                            <div style="text-align: center; color: #999; padding: 40px 20px;">
                                <i class="fas fa-wall-brick" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
                                Fill in wall information and click "Calculate" to preview details
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!-- Updated Window Form with Fixed Column Spacing -->
<div id="windowForm" class="equipment-form">
    <h3>Add New Window</h3>
    <form id="windowDataForm">
        <!-- Basic Information -->
        <div class="form-group">
            <label for="windowType">Window Type</label>
            <input type="text" id="windowType" name="windowType" required>
        </div>
        
        <!-- Largeur Max with Unit Selection -->
        <div class="form-group">
            <label for="windowLargeurMax">Largeur Max</label>
            <div style="display: flex; gap: 8px;">
                <input type="number" 
                    id="windowLargeurMax" 
                    name="windowLargeurMax" 
                    step="0.01" 
                    required
                    style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <select 
                    id="windowLargeurMaxUnit" 
                    name="windowLargeurMaxUnit" 
                    required
                    style="padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 60px;">
                    <option value="m">m</option>
                    <option value="ft">ft</option>
                    <option value="in">in</option>
                </select>
            </div>
        </div>

        <!-- Hauteur Max with Unit Selection -->
        <div class="form-group">
            <label for="windowHauteurMax">Hauteur Max</label>
            <div style="display: flex; gap: 8px;">
                <input type="number" 
                    id="windowHauteurMax" 
                    name="windowHauteurMax" 
                    step="0.01" 
                    required
                    style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                <select 
                    id="windowHauteurMaxUnit" 
                    name="windowHauteurMaxUnit" 
                    required
                    style="padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 60px;">
                    <option value="m">m</option>
                    <option value="ft">ft</option>
                    <option value="in">in</option>
                </select>
            </div>
        </div>
        
        <!-- Jambage Section -->
        <div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
            <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 10px; max-width: 500px;">
                <div class="form-group" style="width: 220px; margin-bottom: 0;">
                    <label for="jambageType">Jambage Type</label>
                    <select id="jambageType" name="jambageType" required>
                        <option value="">Select Jambage Type</option>
                        <option value="JA1">JA1</option>
                        <option value="JA2">JA2</option>
                        <option value="JA3">JA3</option>
                        <option value="JA4">JA4</option>
                        <option value="JA5">JA5</option>
                    </select>
                </div>
                <div class="form-group" style="width: 250px; margin-bottom: 0;">
                    <label for="jambageComposition">Jambage Composition</label>
                    <!-- Replace input with composition builder -->
                    <div id="jambageCompositionBuilder"></div>
                    <input type="hidden" id="jambageComposition" name="jambageComposition">
                </div>
            </div>
        </div>
        
        <!-- Linteau Section -->
        <div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
            <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 10px; max-width: 500px;">
                <div class="form-group" style="width: 220px; margin-bottom: 0;">
                    <label for="linteauType">Linteau Type</label>
                    <select id="linteauType" name="linteauType" required>
                        <option value="">Select Linteau Type</option>
                        <option value="LT1">LT1</option>
                        <option value="LT2">LT2</option>
                        <option value="LT3">LT3</option>
                        <option value="LT4">LT4</option>
                        <option value="LT5">LT5</option>
                    </select>
                </div>
                <div class="form-group" style="width: 250px; margin-bottom: 0;">
                    <label for="linteauComposition">Linteau Composition</label>
                    <!-- Replace input with composition builder -->
                    <div id="linteauCompositionBuilder"></div>
                    <input type="hidden" id="linteauComposition" name="linteauComposition">
                </div>
            </div>
        </div>
        
        <!-- Seuil Section -->
        <div style="border-top: 1px solid #e9ecef; margin: 15px 0 10px 0; padding-top: 12px;">
            <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 10px; max-width: 500px;">
                <div class="form-group" style="width: 220px; margin-bottom: 0;">
                    <label for="seuilType">Seuil Type</label>
                    <select id="seuilType" name="seuilType" required>
                        <option value="">Select Seuil Type</option>
                        <option value="SE1">SE1</option>
                        <option value="SE2">SE2</option>
                        <option value="SE3">SE3</option>
                        <option value="SE4">SE4</option>
                        <option value="SE5">SE5</option>
                    </select>
                </div>
                <div class="form-group" style="width: 250px; margin-bottom: 0;">
                    <label for="seuilComposition">Seuil Composition</label>
                    <!-- Replace input with composition builder -->
                    <div id="seuilCompositionBuilder"></div>
                    <input type="hidden" id="seuilComposition" name="seuilComposition">
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="button success">
                <i class="fas fa-save"></i> Save Window
            </button>
        </div>
    </form>
</div>

<!-- Parapet Form -->
<div id="parapetForm" class="equipment-form-container" style="display: none;">
    <div class="calculation-sections">
        <div class="equipment-form-section">
            <div class="form-fields">
                <h2>New Parapet</h2>
                <form id="parapetFormElement">

                    <!-- Parapet Name (Custom Text Input) -->
                    <div class="form-group">
                        <label for="parapetName">Parapet Name:</label>
                        <input type="text" id="parapetName" name="parapetName" placeholder="Enter parapet name..." required>
                    </div>

                    <!-- Parapet Type (Dropdown) -->
                    <div class="form-group">
                        <label for="parapetType">Parapet Type:</label>
                        <select id="parapetType" name="parapetType" required>
                            <option value="">Select parapet type...</option>
                            <option value="Type 1">Type 1</option>
                            <option value="Type 2">Type 2</option>
                            <option value="Type 3">Type 3</option>
                            <option value="Type 4">Type 4</option>
                            <option value="Type 5">Type 5</option>
                            <option value="Type 6">Type 6</option>
                            <option value="Type 7">Type 7</option>
                            <option value="Type 8">Type 8</option>
                            <option value="Type 9">Type 9</option>
                            <option value="Type 10">Type 10</option>
                        </select>
                    </div>

                    <!-- Hauteur Max with Units -->
<div class="form-group">
    <label for="parapetHauteurMax">Hauteur Max:</label>
    <div style="display: flex; gap: 10px; align-items: center;">
        <input 
            type="number" 
            id="parapetHauteurMax" 
            name="parapetHauteurMax" 
            min="0"
            step="1"
            required 
            style="width: 100px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
        >
        <select 
            id="parapetHauteurMaxUnit" 
            name="parapetHauteurMaxUnit" 
            required 
            style="width: 70px; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
        >
            <option value="">Unit</option>
            <option value="ft">ft</option>
            <option value="m">m</option>
        </select>
        <input 
            type="number" 
            id="parapetHauteurMaxMinor" 
            name="parapetHauteurMaxMinor" 
            min="0"
            step="1"
            style="width: 100px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
        >
        <select 
            id="parapetHauteurMaxMinorUnit" 
            name="parapetHauteurMaxMinorUnit" 
            style="width: 70px; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
        >
            <option value="">Unit</option>
            <option value="in">in</option>
            <option value="cm">cm</option>
        </select>
    </div>
</div>

                    <!-- Montant Métallique -->
                    <div class="form-group">
                        <label for="parapetMontantMetallique">Montant Métallique:</label>
                        <select id="parapetMontantMetallique" name="parapetMontantMetallique" required>
                            <option value="">Select montant métallique...</option>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>

                    <!-- Espacement -->
                    <div class="form-group">
                        <label for="parapetEspacement">Espacement:</label>
                        <select id="parapetEspacement" name="parapetEspacement" required>
                            <option value="">Select espacement...</option>
                            <option value="8&quot;c/c">8"c/c</option>
                            <option value="12&quot;c/c">12"c/c</option>
                            <option value="16&quot;c/c">16"c/c</option>
                            <option value="24&quot;c/c">24"c/c</option>
                        </select>
                    </div>

                    <!-- Lisse Inférieure -->
                    <div class="form-group">
                        <label for="parapetLisseInferieure">Lisse Inférieure:</label>
                        <input type="text" id="parapetLisseInferieure" placeholder="Will be auto-filled..." required>
                    </div>

                    <!-- Lisse Supérieure -->
                    <div class="form-group">
                        <label for="parapetLisseSuperieure">Lisse Supérieure:</label>
                        <input type="text" id="parapetLisseSuperieure" placeholder="Will match Lisse Inférieure..." required>
                    </div>

                    <!-- Entremise -->
                    <div class="form-group">
                        <label for="parapetEntremise">Entremise:</label>
                        <select id="parapetEntremise" name="parapetEntremise" required>
                            <option value="N/A" selected>N/A</option>
                            <option value="150U75-43">150U75-43</option>
                        </select>
                    </div>

                    <!-- Note -->
                    <div class="form-group">
                        <label for="parapetNote">Note:</label>
                        <input type="text" id="parapetNote" maxlength="100" placeholder="Optional note (max 100 characters)...">
                        <div class="form-hint">Maximum 100 characters</div>
                    </div>

                    <!-- Save Button -->
                    <div style="margin-top: 20px;">
                        <button type="submit" id="saveParapet" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; width: 100%;">
                            <i class="fas fa-save"></i> Save Parapet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
    
    <!-- AWS Cognito SDK -->
    <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1692.0/dist/aws-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.15/dist/amazon-cognito-identity.min.js"></script>
    <script src="auth-helper.js"></script>
    
    <script>
    // Colombian data mapping from CSV
    const colombageData = {
        "162S125-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S162-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S125-43": { lisseSuperieur: "162ST250-43 TROUÉE", lisseInferieure: "162T125-43" },
        "250S125-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S162-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S200-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S125-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S162-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S200-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S125-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S200-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S200-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S162-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "250S200-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "362S125-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S162-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S200-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S125-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S162-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S200-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S125-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S200-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S200-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S162-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "362S200-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "212CH-18": { lisseSuperieur: "212CHT250-18 TROUÉE", lisseInferieure: "212CHT125-18" },
        "212CH-34": { lisseSuperieur: "212CHT250-34 TROUÉE", lisseInferieure: "212CHT125-34" },
        "250CH-18": { lisseSuperieur: "250CHT250-18 TROUÉE", lisseInferieure: "250CHT125-18" },
        "250CH-34": { lisseSuperieur: "250CHT250-34 TROUÉE", lisseInferieure: "250CHT125-34" },
        "300CH-18": { lisseSuperieur: "300CHT250-18 TROUÉE", lisseInferieure: "300CHT125-18" },
        "300CH-34": { lisseSuperieur: "300CHT250-34 TROUÉE", lisseInferieure: "300CHT125-34" },
        "350CH-18": { lisseSuperieur: "350CHT250-18 TROUÉE", lisseInferieure: "350CHT125-18" },
        "350CH-34": { lisseSuperieur: "350CHT250-34 TROUÉE", lisseInferieure: "350CHT125-34" },
        "400CH-18": { lisseSuperieur: "400CHT250-18 TROUÉE", lisseInferieure: "400CHT125-18" },
        "400CH-34": { lisseSuperieur: "400CHT250-34 TROUÉE", lisseInferieure: "400CHT125-34" },
        "600S125-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S162-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S200-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S125-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S162-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S200-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S125-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S200-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S200-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S162-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "600S200-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "800S125-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S162-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S200-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S125-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S162-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S200-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S125-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S200-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S200-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S162-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "800S200-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "1000S125-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S162-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S200-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S125-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S162-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S200-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" }
    };

    // Initialize form functionality
    document.addEventListener('DOMContentLoaded', function() {
        initializeMontantDropdown();
        setupMontantChangeHandler();
        setupParapetMontantAutoFill();
        initializeTabSystem();
        initializeOptionsSystem();
    });

    function toggleSet2(show) {
    const set2 = document.getElementById('set2');
    const addBtn = document.getElementById('addSet2Btn');
    
    if (show) {
        set2.style.display = 'block';
        addBtn.style.display = 'none';
    } else {
        set2.style.display = 'none';
        addBtn.style.display = 'inline-block';
        
        // Clear Set 2 fields
        document.getElementById('montantMetallique2').value = '';
        document.getElementById('espacement2').value = '';
        document.getElementById('lisseSuperieure2').value = '';
        document.getElementById('lisseInferieure2').value = '';
        document.getElementById('entremise2').value = '';
    }
}

    // Populate the Montant Métallique dropdown
// Populate the Montant Métallique dropdown
function initializeMontantDropdown() {
    const montantSelect = document.getElementById('montantMetallique');
    const montantSelect2 = document.getElementById('montantMetallique2');
    const parapetMontantSelect = document.getElementById('parapetMontantMetallique');
    
    if (!montantSelect) return;

    // Clear and populate Set 1
    montantSelect.innerHTML = '<option value="">Select montant métallique...</option>';
    
    const sortedKeys = Object.keys(colombageData).sort();
    sortedKeys.forEach(montant => {
        const option = document.createElement('option');
        option.value = montant;
        option.textContent = montant;
        montantSelect.appendChild(option);
    });

    // Populate Set 2
    if (montantSelect2) {
        montantSelect2.innerHTML = '<option value="">Select montant métallique...</option>';
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            montantSelect2.appendChild(option);
        });
    }

    // Populate Parapet Montant Dropdown
    if (parapetMontantSelect) {
        parapetMontantSelect.innerHTML = '<option value="">Select montant métallique...</option>';
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            parapetMontantSelect.appendChild(option);
        });
        console.log(`Populated parapet montant dropdown with ${sortedKeys.length} options`);
    }

    console.log(`Populated ${sortedKeys.length} montant métallique options for walls and parapets`);
}

    // Setup change handler for montant selection
function setupMontantChangeHandler() {
    const montantSelect = document.getElementById('montantMetallique');
    const lisseSuperieureInput = document.getElementById('lisseSuperieure');
    const lisseInferieureInput = document.getElementById('lisseInferieure');
    
    const montantSelect2 = document.getElementById('montantMetallique2');
    const lisseSuperieureInput2 = document.getElementById('lisseSuperieure2');
    const lisseInferieureInput2 = document.getElementById('lisseInferieure2');

    // Set 1 handler
    if (montantSelect && lisseSuperieureInput && lisseInferieureInput) {
        montantSelect.addEventListener('change', function() {
            const selectedMontant = this.value;
            
            if (selectedMontant && colombageData[selectedMontant]) {
                const data = colombageData[selectedMontant];
                lisseSuperieureInput.value = data.lisseSuperieur;
                lisseInferieureInput.value = data.lisseInferieure;
                
                lisseSuperieureInput.classList.add('auto-filled');
                lisseInferieureInput.classList.add('auto-filled');
                
                [lisseSuperieureInput, lisseInferieureInput].forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('auto-filled');
                    }, { once: true });
                });
            } else {
                lisseSuperieureInput.value = '';
                lisseInferieureInput.value = '';
                lisseSuperieureInput.classList.remove('auto-filled');
                lisseInferieureInput.classList.remove('auto-filled');
            }
        });
    }

    // Set 2 handler
    if (montantSelect2 && lisseSuperieureInput2 && lisseInferieureInput2) {
        montantSelect2.addEventListener('change', function() {
            const selectedMontant = this.value;
            
            if (selectedMontant && colombageData[selectedMontant]) {
                const data = colombageData[selectedMontant];
                lisseSuperieureInput2.value = data.lisseSuperieur;
                lisseInferieureInput2.value = data.lisseInferieure;
                
                lisseSuperieureInput2.classList.add('auto-filled');
                lisseInferieureInput2.classList.add('auto-filled');
                
                [lisseSuperieureInput2, lisseInferieureInput2].forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('auto-filled');
                    }, { once: true });
                });
            } else {
                lisseSuperieureInput2.value = '';
                lisseInferieureInput2.value = '';
                lisseSuperieureInput2.classList.remove('auto-filled');
                lisseInferieureInput2.classList.remove('auto-filled');
            }
        });
    }
}

    // Update the form validation function to work with dropdowns
    function getWallFormDataWithImages() {
        console.log('=== DEBUG: Starting form validation with dropdowns ===');
        
        // Get elements first and check if they exist
        const equipmentEl = document.getElementById('equipment');
        const floorEl = document.getElementById('floor');
        const hauteurMaxEl = document.getElementById('hauteurMax');
        const deflexionMaxEl = document.getElementById('deflexionMax');
        const montantMetalliqueEl = document.getElementById('montantMetallique');
        const lisseSuperieureEl = document.getElementById('lisseSuperieure');
        const lisseInferieureEl = document.getElementById('lisseInferieure');
        const entremiseEl = document.getElementById('entremise');

        // Get values
        const equipment = equipmentEl ? equipmentEl.value.trim() : '';
        const floor = floorEl ? floorEl.value.trim() : '';
        const hauteurMax = hauteurMaxEl ? hauteurMaxEl.value.trim() : '';
        const deflexionMax = deflexionMaxEl ? deflexionMaxEl.value.trim() : '';
        const montantMetallique = montantMetalliqueEl ? montantMetalliqueEl.value.trim() : '';
        const lisseSuperieure = lisseSuperieureEl ? lisseSuperieureEl.value.trim() : '';
        const lisseInferieure = lisseInferieureEl ? lisseInferieureEl.value.trim() : '';
        const entremise = entremiseEl ? entremiseEl.value.trim() : '';

        // Debug: Check values
        console.log('Form values:', {
            equipment, floor, hauteurMax, deflexionMax, 
            montantMetallique, lisseSuperieure, lisseInferieure, entremise
        });

        // Validation
        if (!equipment) {
            alert('Please enter a wall name.');
            return null;
        }

        if (!floor) {
            alert('Please enter a floor.');
            return null;
        }

        if (!hauteurMax) {
            alert('Please select a hauteur max.');
            return null;
        }

        if (!deflexionMax) {
            alert('Please select a déflexion max.');
            return null;
        }

        if (!montantMetallique) {
            alert('Please select montant métallique.');
            return null;
        }

        if (!lisseSuperieure) {
            alert('Please enter lisse supérieure.');
            return null;
        }

        if (!lisseInferieure) {
            alert('Please enter lisse inférieure.');
            return null;
        }

        if (!entremise) {
            alert('Please select entremise.');
            return null;
        }

        console.log('=== DEBUG: All validations passed ===');

        const wallData = {
            equipment: equipment,
            floor: floor,
            hauteurMax: hauteurMax, // Now a string from dropdown
            deflexionMax: deflexionMax,
            montantMetallique: montantMetallique,
            lisseSuperieure: lisseSuperieure,
            lisseInferieure: lisseInferieure,
            entremise: entremise,
            images: [...(window.currentWallImages || [])], // Include uploaded images
            dateAdded: new Date().toISOString(),
            addedBy: window.currentUser?.email || 'unknown'
        };

        console.log('Final wall data:', wallData);
        return wallData;
    }

    // Make the function globally available
    window.getWallFormDataWithImages = getWallFormDataWithImages;
    window.colombageData = colombageData;
    </script>
    
    <script src="config.js"></script>
    <script>
    function initGoogleMaps() {
        console.log('Google Maps API loaded successfully for CFSS project details');
    }
    
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=${CONFIG.GOOGLE_API_KEY}&libraries=places&loading=async&callback=initGoogleMaps`;
    script.async = true;
    script.defer = true;
    script.onerror = () => console.error('Failed to load Google Maps API');
    document.head.appendChild(script);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1692.0/dist/aws-sdk.min.js"></script>
    <script src="auth-helper.js"></script>
    <script src="cfss-project-details.js"></script>
    <script src="cfss-project-details-init.js"></script>
    <script src="cfss-custom-pages.js"></script>
</body>
</html>