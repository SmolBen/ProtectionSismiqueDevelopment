<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFSS Project Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="project-details.css">
    <link rel="stylesheet" href="cfss-project-details.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        /* Enhanced form styles for better UX */
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .auto-filled {
            background-color: #f8f9fa !important;
            border-color: #28a745;
        }
        
        .auto-filled:focus {
            background-color: white !important;
            border-color: #007bff;
        }
        
        .form-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="title-area">
                <a href="https://www.protectionsismique2000.com/" class="title">Protection Sismique - CFSS</a>
                <a href="cfss-dashboard.html" class="dashboard-btn">
                    <i class="fas fa-th-large"></i>
                    Dashboard
                </a>
            </div>
            <div class="user-info" id="userInfo">
                <!-- User info will be populated by JavaScript -->
            </div>
        </div>
    </nav>
    
    <div class="loading-project" id="loadingProject">
        <h2>Loading CFSS Project...</h2>
        <p>Please wait while we load the project details.</p>
    </div>
    
    <div class="auth-error" id="authError" style="display: none;">
        <h2>Authentication Required</h2>
        <p>Please log in to view CFSS project details.</p>
        <button onclick="window.location.href='auth.html'">Go to Login</button>
    </div>
    
    <div class="access-denied" id="accessDenied" style="display: none;">
        <h2>Access Denied</h2>
        <p>You don't have permission to view this CFSS project.</p>
        <button onclick="window.location.href='cfss-dashboard.html'">Back to CFSS Dashboard</button>
    </div>
    
    <div class="container" id="projectContainer" style="display: none;">
        <!-- Top Half split into two horizontal sections -->
        <div class="top-half">
            <div class="left-section">
                <h1>CFSS Project Details</h1>
                
                <!-- Basic Information (Always Visible) -->
                <div class="basic-info">
                    <p><strong>Project Name:</strong> <span id="projectName"></span></p>
                    <p><strong>Description:</strong> <span id="projectDescription"></span></p>
                    <p><strong>Type:</strong> <span id="projectType"></span></p>
                    <p><strong>Status:</strong> 
                        <select id="projectStatusDropdown">
                            <option value="Planning">Planning</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </p>
                    <p><strong>Address:</strong> <span id="projectAddress"></span></p>
                </div>

                <!-- CFSS Data Display (shows saved data) -->
                <div id="cfssDataDisplay" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                    <h3 style="margin: 0 0 10px 0; color: #17a2b8; font-size: 16px;">CFSS Wind Data</h3>
                    <div id="cfssDataContent">
                        <!-- CFSS data will be populated here by JavaScript -->
                    </div>
                </div>

                <div id="projectOwnerInfo">
                    <!-- Owner info will be populated for admins -->
                </div>
            </div>
            <div class="right-section">
                <h1>Wall List</h1>
                <div id="equipmentList"></div>
                <div class="equipment-actions" style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <button id="generateCFSSReportButton" class="button primary" style="background: #28a745;">
                        <i class="fas fa-file-pdf"></i> Generate CFSS Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Bottom Half for Wall Details -->
        <div class="bottom-half">
            <div class="cfss-data-section">
                <button class="cfss-btn" onclick="toggleCFSSForm()">
                    <i class="fas fa-plus"></i>
                    <span id="cfss-btn-text">Add CFSS Data</span>
                </button>
                
<div id="cfss-form" class="cfss-form hidden">
    <!-- Floor-specific sections (can have multiple) -->
    <div id="floor-sections">
        <div class="floor-section">
            <div class="main-fields-row">
                <div class="field-group floor-range">
                    <label>Floor Range:</label>
                    <input type="text" class="floor-input" placeholder="e.g., 1-4">
                </div>
                
                <div class="field-group resistance">
                    <label>Resistance:</label>
                    <div class="field-with-unit">
                        <input type="number" class="value-input" placeholder="0.0" step="0.1">
                        <span class="unit-label">cfs</span>
                    </div>
                </div>
                
                <div class="field-group deflection">
                    <label>Deflection:</label>
                    <div class="field-with-unit">
                        <input type="number" class="value-input" placeholder="0.0" step="0.1">
                        <span class="unit-label">cfs</span>
                    </div>
                </div>
                
                <button class="remove-btn" onclick="removeCFSSSection(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Floor Section Button -->
    <button class="add-section-btn" onclick="addCFSSFloorSection()">
        <i class="fas fa-plus"></i> Add Floor Section
    </button>
    
    <!-- Project-wide fields (single instance) -->
    <div class="project-fields">
        <div class="field-row">
            <label>Max Deflection:</label>
            <input type="text" id="maxDeflection" class="text-input" placeholder="Enter max deflection">
        </div>
        
        <div class="field-row">
            <label>Max Spacing Between Braces:</label>
            <input type="text" id="maxSpacing" class="text-input" placeholder="Enter max spacing">
        </div>
        
        <div class="field-row">
            <label>Framing Assembly:</label>
            <input type="text" id="framingAssembly" class="text-input" placeholder="Enter framing assembly">
        </div>
        
        <div class="field-row">
            <label>Concrete Anchor:</label>
            <input type="text" id="concreteAnchor" class="text-input" placeholder="Enter concrete anchor">
        </div>
        
        <div class="field-row">
            <label>Steel Anchor:</label>
            <input type="text" id="steelAnchor" class="text-input" placeholder="Enter steel anchor">
        </div>
        
        <div class="field-row">
            <label>Min Metal Framing Thickness:</label>
            <input type="text" id="minMetalThickness" class="text-input" placeholder="Enter min thickness">
        </div>
        
        <div class="field-row">
            <label>Lisse Inférieure:</label>
            <input type="text" id="cfssLisseInferieure" class="text-input" placeholder="Enter lisse inférieure">
        </div>
        
        <div class="field-row">
            <label>Lisse Supérieure:</label>
            <input type="text" id="cfssLisseSuperieure" class="text-input" placeholder="Enter lisse supérieure">
        </div>
    </div>
    
    <!-- Save Button -->
    <button class="save-cfss-btn" onclick="saveCFSSData()">
        <i class="fas fa-save"></i> Save CFSS Data
    </button>
</div>
                
            <button id="newCalculationButton">Add Wall</button>
            <div id="equipmentForm">
                <div class="calculation-sections">
                    <!-- Section 1: Wall Form -->
                    <div class="equipment-form-section">
                        <!-- Form Fields (Left side within the section) -->
                        <div class="form-fields">
                            <h2>New Wall</h2>
                            <form id="equipmentFormElement">
                                <!-- 1. Wall Name -->
                                <div class="form-group">
                                    <label for="equipment">Wall Name:</label>
                                    <input type="text" id="equipment" name="equipment" placeholder="Enter wall name..." required>
                                </div>

                                <!-- 2. Floor -->
                                <div class="form-group">
                                    <label for="floor">Floor:</label>
                                    <input type="text" id="floor" name="floor" placeholder="Enter floor..." required>
                                </div>

                                <!-- 3. Hauteur Max - MANUAL INPUT WITH UNIT SELECTION -->
                                <div class="form-group">
                                    <label for="hauteurMax">Hauteur Max:</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input 
                                            type="text" 
                                            id="hauteurMax" 
                                            name="hauteurMax" 
                                            required 
                                            style="flex: 3; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                        <select 
                                            id="hauteurMaxUnit" 
                                            name="hauteurMaxUnit" 
                                            required 
                                            style="flex: 2; max-width: 70px; padding: 8px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                                        >
                                            <option value="ft-in" selected>ft-in</option>
                                            <option value="mm">mm</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- 4. Déflexion Max -->
                                <div class="form-group">
                                    <label for="deflexionMax">Déflexion Max:</label>
                                    <select id="deflexionMax" name="deflexionMax" required>
                                        <option value="">Select déflexion max...</option>
                                        <option value="L/360">L/360</option>
                                        <option value="L/480">L/480</option>
                                        <option value="L/600">L/600</option>
                                        <option value="L/720">L/720</option>
                                    </select>
                                </div>

                                <!-- 5. Montant Métallique - NOW A DROPDOWN -->
                                <div class="form-group">
                                    <label for="montantMetallique">Montant Métallique:</label>
                                    <select id="montantMetallique" name="montantMetallique" required>
                                        <option value="">Select montant métallique...</option>
                                        <!-- Options will be populated by JavaScript from CSV data -->
                                    </select>
                                </div>

                                <!-- 6. Lisse Supérieure - AUTO-POPULATED BUT EDITABLE -->
                                <div class="form-group">
                                    <label for="lisseSuperieure">Lisse Supérieure:</label>
                                    <input type="text" id="lisseSuperieure" name="lisseSuperieure" placeholder="Will be auto-filled based on montant selection..." required>
                                </div>

                                <!-- 7. Lisse Inférieure - AUTO-POPULATED BUT EDITABLE -->
                                <div class="form-group">
                                    <label for="lisseInferieure">Lisse Inférieure:</label>
                                    <input type="text" id="lisseInferieure" name="lisseInferieure" placeholder="Will be auto-filled based on montant selection..." required>
                                </div>

                                <!-- 8. Entremise - NOW A DROPDOWN -->
                                <div class="form-group">
                                    <label for="entremise">Entremise:</label>
                                    <select id="entremise" name="entremise" required>
                                        <option value="">Select entremise...</option>
                                        <option value="150U75-43 @48&quot;c/c">150U75-43 @48"c/c</option>
                                        <option value="N/A">N/A</option>
                                    </select>
                                </div>
                                
                                <!-- Calculate and Save Buttons -->
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" id="calculateEquipment" style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-calculator"></i> Calculate
                                    </button>
                                    <button type="submit" id="saveEquipment" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; flex: 1;">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                </div>
                            </form>
                        </div>

                            <!-- Image Upload Section (Right side within the section) -->
                            <!-- This will be dynamically added by JavaScript via initializeImageUpload() -->
                            
                            <input type="file" id="imageFileInput" multiple accept="image/*" style="display: none;">
                        </div>

                    <!-- Section 2: Placeholder for calculations (no calculations for CFSS) -->
                    <div class="calculation-results-section">
                        <div id="calculationResults" style="display: none;">
                            <h2>Wall Details</h2>
                            <div id="calculationResultsContent"></div>
                        </div>
                        <div id="calculationPlaceholder">
                            <h2 style="color: #666; text-align: center; margin-bottom: 10px;">Wall Details</h2>
                            <div style="text-align: center; color: #999; padding: 40px 20px;">
                                <i class="fas fa-wall-brick" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
                                Fill in wall information and click "Calculate" to preview details
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AWS Cognito SDK -->
    <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1692.0/dist/aws-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.15/dist/amazon-cognito-identity.min.js"></script>
    <script src="auth-helper.js"></script>
    
    <script>
    // Colombian data mapping from CSV
    const colombageData = {
        "162S125-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S162-33": { lisseSuperieur: "162ST250-33 TROUÉE", lisseInferieure: "162T125-33" },
        "162S125-43": { lisseSuperieur: "162ST250-43 TROUÉE", lisseInferieure: "162T125-43" },
        "250S125-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S162-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S200-33": { lisseSuperieur: "250ST250-33 TROUÉE", lisseInferieure: "250T125-33" },
        "250S125-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S162-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S200-43": { lisseSuperieur: "250ST250-43 TROUÉE", lisseInferieure: "250T125-43" },
        "250S125-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S200-54": { lisseSuperieur: "250ST250-54 TROUÉE", lisseInferieure: "250T125-54" },
        "250S162-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S200-68": { lisseSuperieur: "250ST250-68 TROUÉE", lisseInferieure: "250T125-68" },
        "250S162-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "250S200-97": { lisseSuperieur: "250ST250-97 TROUÉE", lisseInferieure: "250T125-97" },
        "362S125-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S162-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S200-33": { lisseSuperieur: "362ST250-33 TROUÉE", lisseInferieure: "362T125-33" },
        "362S125-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S162-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S200-43": { lisseSuperieur: "362ST250-43 TROUÉE", lisseInferieure: "362T125-43" },
        "362S125-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S200-54": { lisseSuperieur: "362ST250-54 TROUÉE", lisseInferieure: "362T125-54" },
        "362S162-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S200-68": { lisseSuperieur: "362ST250-68 TROUÉE", lisseInferieure: "362T125-68" },
        "362S162-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "362S200-97": { lisseSuperieur: "362ST250-97 TROUÉE", lisseInferieure: "362T125-97" },
        "212CH-18": { lisseSuperieur: "212CHT250-18 TROUÉE", lisseInferieure: "212CHT125-18" },
        "212CH-34": { lisseSuperieur: "212CHT250-34 TROUÉE", lisseInferieure: "212CHT125-34" },
        "250CH-18": { lisseSuperieur: "250CHT250-18 TROUÉE", lisseInferieure: "250CHT125-18" },
        "250CH-34": { lisseSuperieur: "250CHT250-34 TROUÉE", lisseInferieure: "250CHT125-34" },
        "300CH-18": { lisseSuperieur: "300CHT250-18 TROUÉE", lisseInferieure: "300CHT125-18" },
        "300CH-34": { lisseSuperieur: "300CHT250-34 TROUÉE", lisseInferieure: "300CHT125-34" },
        "350CH-18": { lisseSuperieur: "350CHT250-18 TROUÉE", lisseInferieure: "350CHT125-18" },
        "350CH-34": { lisseSuperieur: "350CHT250-34 TROUÉE", lisseInferieure: "350CHT125-34" },
        "400CH-18": { lisseSuperieur: "400CHT250-18 TROUÉE", lisseInferieure: "400CHT125-18" },
        "400CH-34": { lisseSuperieur: "400CHT250-34 TROUÉE", lisseInferieure: "400CHT125-34" },
        "600S125-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S162-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S200-33": { lisseSuperieur: "600ST250-33 TROUÉE", lisseInferieure: "600T125-33" },
        "600S125-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S162-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S200-43": { lisseSuperieur: "600ST250-43 TROUÉE", lisseInferieure: "600T125-43" },
        "600S125-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S200-54": { lisseSuperieur: "600ST250-54 TROUÉE", lisseInferieure: "600T125-54" },
        "600S162-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S200-68": { lisseSuperieur: "600ST250-68 TROUÉE", lisseInferieure: "600T125-68" },
        "600S162-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "600S200-97": { lisseSuperieur: "600ST250-97 TROUÉE", lisseInferieure: "600T125-97" },
        "800S125-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S162-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S200-33": { lisseSuperieur: "800ST250-33 TROUÉE", lisseInferieure: "800T125-33" },
        "800S125-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S162-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S200-43": { lisseSuperieur: "800ST250-43 TROUÉE", lisseInferieure: "800T125-43" },
        "800S125-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S200-54": { lisseSuperieur: "800ST250-54 TROUÉE", lisseInferieure: "800T125-54" },
        "800S162-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S200-68": { lisseSuperieur: "800ST250-68 TROUÉE", lisseInferieure: "800T125-68" },
        "800S162-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "800S200-97": { lisseSuperieur: "800ST250-97 TROUÉE", lisseInferieure: "800T125-97" },
        "1000S125-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S162-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S200-33": { lisseSuperieur: "1000ST250-33 TROUÉE", lisseInferieure: "1000T125-33" },
        "1000S125-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S162-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" },
        "1000S200-43": { lisseSuperieur: "1000ST250-43 TROUÉE", lisseInferieure: "1000T125-43" }
    };

    // Initialize form functionality
    document.addEventListener('DOMContentLoaded', function() {
        initializeMontantDropdown();
        setupMontantChangeHandler();
    });

    // Populate the Montant Métallique dropdown
    function initializeMontantDropdown() {
        const montantSelect = document.getElementById('montantMetallique');
        if (!montantSelect) return;

        // Clear existing options except the first one
        montantSelect.innerHTML = '<option value="">Select montant métallique...</option>';

        // Sort the keys alphabetically and add options
        const sortedKeys = Object.keys(colombageData).sort();
        sortedKeys.forEach(montant => {
            const option = document.createElement('option');
            option.value = montant;
            option.textContent = montant;
            montantSelect.appendChild(option);
        });

        console.log(`Populated ${sortedKeys.length} montant métallique options`);
    }

    // Setup change handler for montant selection
    function setupMontantChangeHandler() {
        const montantSelect = document.getElementById('montantMetallique');
        const lisseSuperieureInput = document.getElementById('lisseSuperieure');
        const lisseInferieureInput = document.getElementById('lisseInferieure');

        if (!montantSelect || !lisseSuperieureInput || !lisseInferieureInput) return;

        montantSelect.addEventListener('change', function() {
            const selectedMontant = this.value;
            
            if (selectedMontant && colombageData[selectedMontant]) {
                const data = colombageData[selectedMontant];
                
                // Auto-fill the lisse fields
                lisseSuperieureInput.value = data.lisseSuperieur;
                lisseInferieureInput.value = data.lisseInferieure;
                
                // Add visual indication that these fields were auto-filled
                lisseSuperieureInput.classList.add('auto-filled');
                lisseInferieureInput.classList.add('auto-filled');
                
                console.log(`Auto-filled lisse fields for ${selectedMontant}`);
                
                // Remove auto-filled styling when user starts typing
                [lisseSuperieureInput, lisseInferieureInput].forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('auto-filled');
                    }, { once: true });
                });
            } else {
                // Clear the fields if no valid selection
                lisseSuperieureInput.value = '';
                lisseInferieureInput.value = '';
                lisseSuperieureInput.classList.remove('auto-filled');
                lisseInferieureInput.classList.remove('auto-filled');
            }
        });
    }

    // Update the form validation function to work with dropdowns
    function getWallFormDataWithImages() {
        console.log('=== DEBUG: Starting form validation with dropdowns ===');
        
        // Get elements first and check if they exist
        const equipmentEl = document.getElementById('equipment');
        const floorEl = document.getElementById('floor');
        const hauteurMaxEl = document.getElementById('hauteurMax');
        const deflexionMaxEl = document.getElementById('deflexionMax');
        const montantMetalliqueEl = document.getElementById('montantMetallique');
        const lisseSuperieureEl = document.getElementById('lisseSuperieure');
        const lisseInferieureEl = document.getElementById('lisseInferieure');
        const entremiseEl = document.getElementById('entremise');

        // Get values
        const equipment = equipmentEl ? equipmentEl.value.trim() : '';
        const floor = floorEl ? floorEl.value.trim() : '';
        const hauteurMax = hauteurMaxEl ? hauteurMaxEl.value.trim() : '';
        const deflexionMax = deflexionMaxEl ? deflexionMaxEl.value.trim() : '';
        const montantMetallique = montantMetalliqueEl ? montantMetalliqueEl.value.trim() : '';
        const lisseSuperieure = lisseSuperieureEl ? lisseSuperieureEl.value.trim() : '';
        const lisseInferieure = lisseInferieureEl ? lisseInferieureEl.value.trim() : '';
        const entremise = entremiseEl ? entremiseEl.value.trim() : '';

        // Debug: Check values
        console.log('Form values:', {
            equipment, floor, hauteurMax, deflexionMax, 
            montantMetallique, lisseSuperieure, lisseInferieure, entremise
        });

        // Validation
        if (!equipment) {
            alert('Please enter a wall name.');
            return null;
        }

        if (!floor) {
            alert('Please enter a floor.');
            return null;
        }

        if (!hauteurMax) {
            alert('Please select a hauteur max.');
            return null;
        }

        if (!deflexionMax) {
            alert('Please select a déflexion max.');
            return null;
        }

        if (!montantMetallique) {
            alert('Please select montant métallique.');
            return null;
        }

        if (!lisseSuperieure) {
            alert('Please enter lisse supérieure.');
            return null;
        }

        if (!lisseInferieure) {
            alert('Please enter lisse inférieure.');
            return null;
        }

        if (!entremise) {
            alert('Please select entremise.');
            return null;
        }

        console.log('=== DEBUG: All validations passed ===');

        const wallData = {
            equipment: equipment,
            floor: floor,
            hauteurMax: hauteurMax, // Now a string from dropdown
            deflexionMax: deflexionMax,
            montantMetallique: montantMetallique,
            lisseSuperieure: lisseSuperieure,
            lisseInferieure: lisseInferieure,
            entremise: entremise,
            images: [...(window.currentWallImages || [])], // Include uploaded images
            dateAdded: new Date().toISOString(),
            addedBy: window.currentUser?.email || 'unknown'
        };

        console.log('Final wall data:', wallData);
        return wallData;
    }

    // Make the function globally available
    window.getWallFormDataWithImages = getWallFormDataWithImages;
    window.colombageData = colombageData;
    </script>
    
    <script src="cfss-project-details.js"></script>
    <script src="cfss-project-details-init.js"></script>
</body>
</html>